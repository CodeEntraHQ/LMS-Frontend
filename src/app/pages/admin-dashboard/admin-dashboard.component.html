    <div class="page" [style.--entity-primary-color]="(entity && entity.primaryColor) || '#10b981'">
      <!-- Top Nav -->
      <header class="nav">
        <div class="nav-left">
          <a class="brand" routerLink="/admin/dashboard">
            <svg class="brand-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="brand-text">LMS</span>
          </a>
        </div>
        <div class="nav-center">
          <div class="breadcrumb">
            <a *ngIf="userRole === 'SUPERADMIN'" routerLink="/superadmin/dashboard" class="breadcrumb-link">Dashboard</a>
            <span *ngIf="userRole === 'SUPERADMIN'" class="breadcrumb-separator">></span>
            <span *ngIf="userRole === 'SUPERADMIN' && entity" class="breadcrumb-link">{{ entity.name }}</span>
            <span *ngIf="userRole !== 'SUPERADMIN'" class="breadcrumb-current">Dashboard</span>
          </div>
        </div>
        <div class="nav-right">
          <button class="icon-btn" (click)="toggleTheme()" aria-label="Toggle theme">
            <svg *ngIf="isDarkMode" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="4" stroke="currentColor" stroke-width="2"/>
              <path d="M12 2V4M12 20V22M4.93 4.93L6.34 6.34M17.66 17.66L19.07 19.07M2 12H4M20 12H22M4.93 19.07L6.34 17.66M17.66 6.34L19.07 4.93" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <svg *ngIf="!isDarkMode" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>

          <button class="user-trigger" type="button" (click)="toggleUserMenu($event)" aria-label="Open user menu">
            <div class="avatar" [style.background-image]="profileImage ? 'url(' + profileImage + ')' : 'none'">
              <span *ngIf="!profileImage">{{ userInitial }}</span>
            </div>
            <div class="user-block">
              <div class="user-name">{{ userName }}</div>
              <div class="user-badge">{{ userRole === 'SUPERADMIN' ? 'SUPERADMIN' : 'ADMIN' }}</div>
            </div>
          </button>

          <div class="user-menu" *ngIf="isUserMenuOpen">
            <div class="user-menu-head">
              <div class="menu-avatar" [style.background-image]="profileImage ? 'url(' + profileImage + ')' : 'none'">
                <span *ngIf="!profileImage">{{ userInitial }}</span>
              </div>
              <div class="menu-meta">
                <div class="menu-name">{{ userName }}</div>
                <div class="menu-email">{{ userEmail }}</div>
              </div>
            </div>
            <div class="menu-divider"></div>
            <button class="menu-item" (click)="goProfile()">
              <span class="mi-ico">üë§</span>
              <span>Profile</span>
            </button>
            <button class="menu-item" (click)="logout()">
              <span class="mi-ico">‚Ü©</span>
              <span>Logout</span>
            </button>
          </div>
        </div>
      </header>

      <main class="content">
        <!-- Loading State -->
        <div *ngIf="isLoading && !entity" class="loading-container">
          <div class="loading-spinner"></div>
          <p>Loading entity...</p>
        </div>

        <!-- Error State -->
        <div *ngIf="!isLoading && !entity && userRole !== 'SUPERADMIN'" class="error-container">
          <p>‚ö†Ô∏è Entity not loaded. Please check your account or contact support.</p>
          <button class="btn-primary" (click)="loadFirstEntity()">Retry</button>
        </div>

        <!-- Entity Header -->
        <div class="entity-header-card" *ngIf="entity">
          <div class="entity-header-left">
            <div class="entity-header-icon">
              <img *ngIf="entity.logoUrl" [src]="entity.logoUrl" alt="Logo" class="entity-logo-img" />
              <span *ngIf="!entity.logoUrl">üè¢</span>
            </div>
            <div class="entity-header-info">
              <div class="entity-header-title">
                <h1>{{ entity.name || 'Loading...' }}</h1>
                <span class="status-badge active" *ngIf="entity.status === 'active'">{{ entity.status }}</span>
              </div>
              <div class="entity-header-meta">
                <span class="type-badge">{{ entity.type }}</span>
                <span class="meta-separator">‚Ä¢</span>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M21 10C21 17 12 23 12 23C12 23 3 17 3 10C3 7.61305 3.94821 5.32387 5.63604 3.63604C7.32387 1.94821 9.61305 1 12 1C14.3869 1 16.6761 1.94821 18.364 3.63604C20.0518 5.32387 21 7.61305 21 10Z" stroke="currentColor" stroke-width="2"/>
                  <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span>{{ entity.address || 'N/A' }}</span>
                <span class="meta-separator">‚Ä¢</span>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                  <path d="M16 2V6M8 2V6M3 10H21" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span>Created {{ formatDate(entity.createdAt) || 'N/A' }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
          <button class="nav-tab" [class.active]="activeTab === 'admissions'" (click)="activeTab = 'admissions'">
            <span class="tab-emoji">üéì</span>
            <span>Admissions</span>
          </button>
          <button class="nav-tab" [class.active]="activeTab === 'students'" (click)="activeTab = 'students'">
            <span class="tab-emoji">üë®‚Äçüéì</span>
            <span>Students</span>
          </button>
          <button class="nav-tab" [class.active]="activeTab === 'teachers'" (click)="activeTab = 'teachers'">
            <span class="tab-emoji">üë©‚Äçüè´</span>
            <span>Teachers</span>
          </button>
          <button class="nav-tab" [class.active]="activeTab === 'reports'" (click)="activeTab = 'reports'">
            <span class="tab-emoji">üìä</span>
            <span>Reports</span>
          </button>
          <button class="nav-tab" [class.active]="activeTab === 'fees'" (click)="onFeesTabClick()">
            <span class="tab-emoji">üí∞</span>
            <span>Fees</span>
          </button>
          <button class="nav-tab" [class.active]="activeTab === 'dashboard'" (click)="activeTab = 'dashboard'">
            <span class="tab-emoji">üìä</span>
            <span>My Dashboard</span>
          </button>
          <button class="nav-tab" [class.active]="activeTab === 'subjects'" (click)="activeTab = 'subjects'" *ngIf="isFeatureEnabled('My Subjects') || isFeatureEnabled('subjects')">
            <span class="tab-emoji">üìö</span>
            <span>My Subjects</span>
          </button>
          <button class="nav-tab" [class.active]="activeTab === 'subject-list'" (click)="activeTab = 'subject-list'; loadSubjectList()">
            <span class="tab-emoji">üìã</span>
            <span>Subject List</span>
          </button>
          <button class="nav-tab" [class.active]="activeTab === 'syllabus-materials'" (click)="activeTab = 'syllabus-materials'; loadSubjectList()">
            <span class="tab-emoji">üìö</span>
            <span>Syllabus & Materials</span>
          </button>
          <button class="nav-tab" [class.active]="activeTab === 'assignments'" (click)="onAssignmentsTabClick()">
            <span class="tab-emoji">üìù</span>
            <span>Assignments</span>
          </button>
          <button class="nav-tab" [class.active]="activeTab === 'exam-attempts'" (click)="activeTab = 'exam-attempts'">
            <span class="tab-emoji">üß™</span>
            <span>Exams</span>
          </button>
          <button class="nav-tab" [class.active]="activeTab === 'questions'" (click)="activeTab = 'questions'">
            <span class="tab-emoji">üìö</span>
            <span>Questions</span>
          </button>
          <button class="nav-tab" [class.active]="activeTab === 'attendance'" (click)="onAttendanceTabClick()">
            <span class="tab-emoji">üìÖ</span>
            <span>Attendance</span>
          </button>
          <button class="nav-tab" [class.active]="activeTab === 'notices'" (click)="onNoticesTabClick()">
            <span class="tab-emoji">üì¢</span>
            <span>Notices</span>
          </button>
          <button class="nav-tab" [class.active]="activeTab === 'teacher-announcements'" (click)="onTeacherAnnouncementsTabClick()">
            <span class="tab-emoji">üïµÔ∏è</span>
            <span>Teacher Announcements</span>
          </button>
          <button class="nav-tab" [class.active]="activeTab === 'settings'" (click)="activeTab = 'settings'">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
              <path d="M12 1V3M12 21V23M4.22 4.22L5.64 5.64M18.36 18.36L19.78 19.78M1 12H3M21 12H23M4.22 19.78L5.64 18.36M18.36 5.64L19.78 4.22" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <span>Settings</span>
          </button>
        </div>

        <!-- My Dashboard Tab -->
        <div class="dashboard-section" *ngIf="activeTab === 'dashboard' && entity">
          <div class="section-header">
            <div>
              <h2 class="section-title">My Dashboard</h2>
              <p class="section-subtitle">Overview of your enrolled courses, exams, and assignments</p>
            </div>
          </div>
          <div class="dashboard-content">
            <div class="dashboard-card">
              <h3 class="card-title">Enrolled course / class</h3>
              <p class="card-text">No enrolled courses yet</p>
            </div>
            <div class="dashboard-card">
              <h3 class="card-title">Upcoming exams</h3>
              <p class="card-text">No upcoming exams</p>
            </div>
            <div class="dashboard-card">
              <h3 class="card-title">Pending assignments</h3>
              <p class="card-text">No pending assignments</p>
            </div>
          </div>
        </div>

        <!-- Admissions Tab -->
        <div class="dashboard-section" *ngIf="activeTab === 'admissions'">
          <div class="section-header">
            <div>
              <h2 class="section-title">Admissions</h2>
              <p class="section-subtitle">Manage student and teacher admissions, review applications, and approve enrollments</p>
            </div>
          </div>

          <!-- Main Tabs: Student Admission & Teacher Admission -->
          <div class="admission-main-tabs">
            <button class="admission-main-tab" [class.active]="admissionMainTab === 'student'" (click)="switchAdmissionMainTab('student')">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M17 21V19C17 17.9391 16.5786 16.9217 15.8284 16.1716C15.0783 15.4214 14.0609 15 13 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
                <path d="M23 21V19C22.9993 18.1137 22.7044 17.2528 22.1614 16.5523C21.6184 15.8519 20.8581 15.3516 20 15.13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M16 3.13C16.8604 3.35031 17.623 3.85071 18.1676 4.55232C18.7122 5.25392 19.0078 6.11683 19.0078 7.005C19.0078 7.89318 18.7122 8.75608 18.1676 9.45769C17.623 10.1593 16.8604 10.6597 16 10.88" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Student Admission
            </button>
            <button class="admission-main-tab" [class.active]="admissionMainTab === 'teacher'" (click)="switchAdmissionMainTab('teacher')">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M17 21V19C17 17.9391 16.5786 16.9217 15.8284 16.1716C15.0783 15.4214 14.0609 15 13 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
                <path d="M23 21V19C22.9993 18.1137 22.7044 17.2528 22.1614 16.5523C21.6184 15.8519 20.8581 15.3516 20 15.13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M16 3.13C16.8604 3.35031 17.623 3.85071 18.1676 4.55232C18.7122 5.25392 19.0078 6.11683 19.0078 7.005C19.0078 7.89318 18.7122 8.75608 18.1676 9.45769C17.623 10.1593 16.8604 10.6597 16 10.88" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Teacher Admission
            </button>
          </div>

          <!-- Student Admission Section -->
          <div *ngIf="admissionMainTab === 'student'" class="admission-section">
            <!-- Sub-tabs for Student -->
            <div class="admission-sub-tabs">
              <button class="admission-sub-tab" [class.active]="studentSubTab === 'new'" (click)="studentSubTab = 'new'">
                New Admission
              </button>
              <button class="admission-sub-tab" [class.active]="studentSubTab === 'pending'" (click)="loadStudentAdmissions('pending')">
                Pending Applications
              </button>
              <button class="admission-sub-tab" [class.active]="studentSubTab === 'approved'" (click)="loadStudentAdmissions('approved')">
                Approved Students
              </button>
              <button class="admission-sub-tab" [class.active]="studentSubTab === 'rejected'" (click)="loadStudentAdmissions('rejected')">
                Rejected / Hold
              </button>
            </div>

            <!-- New Student Admission Form -->
            <div *ngIf="studentSubTab === 'new'" class="admission-form-section">
              <div class="admission-form-header">
                <h3>New Student Admission</h3>
                <p>Fill in the student details to create a new admission application</p>
              </div>
              <form (ngSubmit)="submitStudentAdmission()" class="admission-form">
                <div class="form-row">
                  <div class="form-group">
                    <label>First Name *</label>
                    <input type="text" class="form-input" [(ngModel)]="studentForm.firstName" name="studentFirstName" required />
                  </div>
                  <div class="form-group">
                    <label>Last Name *</label>
                    <input type="text" class="form-input" [(ngModel)]="studentForm.lastName" name="studentLastName" required />
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label>Email *</label>
                    <input type="email" class="form-input" [(ngModel)]="studentForm.email" name="studentEmail" required />
                  </div>
                  <div class="form-group">
                    <label>Phone</label>
                    <input type="tel" class="form-input" [(ngModel)]="studentForm.phone" name="studentPhone" />
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label>Gender</label>
                    <select class="form-input" [(ngModel)]="studentForm.gender" name="studentGender">
                      <option value="">Select</option>
                      <option value="Male">Male</option>
                      <option value="Female">Female</option>
                      <option value="Other">Other</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label>Course *</label>
                    <select class="form-input" [(ngModel)]="studentForm.courseId" name="studentCourseId" (change)="onStudentFormCourseChange()">
                      <option [value]="null" disabled>Select Course</option>
                      <option *ngFor="let course of courses" [value]="course.id">{{ course.name }}</option>
                    </select>
                    <div *ngIf="courses.length === 0" style="color: #ef4444; font-size: 12px; margin-top: 4px;">No courses available. Create courses first.</div>
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label>Academic Year</label>
                    <input type="text" class="form-input" [(ngModel)]="studentForm.academicYear" name="studentAcademicYear" />
                  </div>
                </div>
                <div class="form-group">
                  <label>Address</label>
                  <textarea class="form-input" [(ngModel)]="studentForm.address" name="studentAddress" rows="3"></textarea>
                </div>
                <div class="form-group">
                  <label>Previous Qualification</label>
                  <textarea class="form-input" [(ngModel)]="studentForm.previousQualification" name="studentPreviousQualification" rows="3"></textarea>
                </div>

                <!-- Document Upload Section -->
                <div class="documents-section">
                  <h4>Documents</h4>
                  <div class="doc-grid">
                    <div class="doc-item">
                      <label>ID Proof</label>
                      <input type="file" #idProofInput (change)="onFileSelect($event, 'student', 'idProof')" accept="image/*,.pdf" style="display: none;" />
                      <button type="button" class="doc-upload-btn" (click)="idProofInput.click()">Upload</button>
                      <img *ngIf="studentForm.idProof" [src]="studentForm.idProof" class="doc-preview" />
                    </div>
                    <div class="doc-item">
                      <label>Marksheet</label>
                      <input type="file" #marksheetInput (change)="onFileSelect($event, 'student', 'marksheet')" accept="image/*,.pdf" style="display: none;" />
                      <button type="button" class="doc-upload-btn" (click)="marksheetInput.click()">Upload</button>
                      <img *ngIf="studentForm.marksheet" [src]="studentForm.marksheet" class="doc-preview" />
                    </div>
                    <div class="doc-item">
                      <label>TC / LC</label>
                      <input type="file" #tcLcInput (change)="onFileSelect($event, 'student', 'tcLc')" accept="image/*,.pdf" style="display: none;" />
                      <button type="button" class="doc-upload-btn" (click)="tcLcInput.click()">Upload</button>
                      <img *ngIf="studentForm.tcLc" [src]="studentForm.tcLc" class="doc-preview" />
                    </div>
                    <div class="doc-item">
                      <label>Photo</label>
                      <input type="file" #photoInput (change)="onFileSelect($event, 'student', 'photo')" accept="image/*" style="display: none;" />
                      <button type="button" class="doc-upload-btn" (click)="photoInput.click()">Upload</button>
                      <img *ngIf="studentForm.photo" [src]="studentForm.photo" class="doc-preview" />
                    </div>
                  </div>
                </div>

                <div class="form-actions">
                  <button type="button" class="btn-secondary" (click)="resetStudentForm()">Reset</button>
                  <button type="submit" class="btn-primary" [disabled]="isSubmittingStudent">
                    {{ isSubmittingStudent ? 'Submitting...' : 'Submit Application' }}
                  </button>
                </div>
              </form>
            </div>

            <!-- Student Admissions List -->
            <div *ngIf="studentSubTab !== 'new'" class="admission-list-section">
              <div class="admission-list-header">
                <h3>{{ getStudentSubTabTitle() }}</h3>
                <button class="btn-primary" (click)="studentSubTab = 'new'">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                  New Admission
                </button>
              </div>

              <div *ngIf="isLoadingStudentAdmissions" class="loading">Loading...</div>
              <div *ngIf="!isLoadingStudentAdmissions && studentAdmissions.length === 0" class="empty-state">
                <p>No {{ studentSubTab }} applications found</p>
              </div>

              <div *ngIf="!isLoadingStudentAdmissions && studentAdmissions.length > 0" class="admissions-list">
                <div class="admission-card" *ngFor="let admission of studentAdmissions">
                  <div class="admission-card-header">
                    <div class="admission-card-title">
                      <div class="admission-avatar">
                        <img *ngIf="admission.photo" [src]="admission.photo" />
                        <span *ngIf="!admission.photo">{{ (admission.firstName && admission.firstName.charAt(0)) || 'S' }}{{ (admission.lastName && admission.lastName.charAt(0)) || '' }}</span>
                      </div>
                      <div>
                        <h4>{{ admission.firstName }} {{ admission.lastName }}</h4>
                        <p>{{ admission.email }}</p>
                      </div>
                    </div>
                    <span class="status-badge" [class]="'status-' + admission.status">{{ admission.status | titlecase }}</span>
                  </div>
                  <div class="admission-card-body">
                    <div class="info-grid">
                      <div class="info-item">
                        <span class="info-label">Class:</span>
                        <span class="info-value">{{ admission.classCourse || 'N/A' }}</span>
                      </div>
                      <div class="info-item">
                        <span class="info-label">Academic Year:</span>
                        <span class="info-value">{{ admission.academicYear || 'N/A' }}</span>
                      </div>
                      <div class="info-item">
                        <span class="info-label">Phone:</span>
                        <span class="info-value">{{ admission.phone || 'N/A' }}</span>
                      </div>
                      <div class="info-item">
                        <span class="info-label">Submitted:</span>
                        <span class="info-value">{{ formatAdmissionDate(admission.submittedAt) }}</span>
                      </div>
                    </div>
                    <div *ngIf="admission.adminRemark" class="remark-section">
                      <strong>Admin Remark:</strong> {{ admission.adminRemark }}
                    </div>
                  </div>
                  <div class="admission-card-actions">
                    <div>
                      <button class="btn-view" (click)="viewAdmission(admission)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M1 12S5 4 12 4S23 12 23 12S19 20 12 20S1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        View
                      </button>
                      <div *ngIf="admission.status === 'submitted' || admission.status === 'under_review'">
                        <button class="btn-approve" (click)="approveStudentAdmission(admission.id!)">
                          ‚úÖ Approve
                        </button>
                        <button class="btn-reject" (click)="rejectStudentAdmission(admission.id!)">
                          ‚ùå Reject
                        </button>
                        <button class="btn-correction" (click)="openCorrectionModal(admission)">
                          üîÑ Correction Required
                        </button>
                      </div>
                    </div>
                    <button class="btn-delete" (click)="deleteStudentAdmission(admission.id!)" [title]="'Delete admission'">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                      Delete
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Teacher Admission Section -->
          <div *ngIf="admissionMainTab === 'teacher'" class="admission-section">
            <!-- Sub-tabs for Teacher -->
            <div class="admission-sub-tabs">
              <button class="admission-sub-tab" [class.active]="teacherSubTab === 'new'" (click)="teacherSubTab = 'new'">
                New Onboarding
              </button>
              <button class="admission-sub-tab" [class.active]="teacherSubTab === 'pending'" (click)="loadTeacherAdmissions('pending')">
                Pending Verification
              </button>
              <button class="admission-sub-tab" [class.active]="teacherSubTab === 'approved'" (click)="loadTeacherAdmissions('approved')">
                Approved Teachers
              </button>
              <button class="admission-sub-tab" [class.active]="teacherSubTab === 'rejected'" (click)="loadTeacherAdmissions('rejected')">
                Rejected / Hold
              </button>
            </div>

            <!-- New Teacher Admission Form -->
            <div *ngIf="teacherSubTab === 'new'" class="admission-form-section">
              <div class="admission-form-header">
                <h3>New Teacher Onboarding</h3>
                <p>Fill in the teacher details to create a new onboarding application</p>
              </div>
              <form (ngSubmit)="submitTeacherAdmission()" class="admission-form">
                <div class="form-row">
                  <div class="form-group">
                    <label>First Name *</label>
                    <input type="text" class="form-input" [(ngModel)]="teacherForm.firstName" name="teacherFirstName" required />
                  </div>
                  <div class="form-group">
                    <label>Last Name *</label>
                    <input type="text" class="form-input" [(ngModel)]="teacherForm.lastName" name="teacherLastName" required />
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label>Email *</label>
                    <input type="email" class="form-input" [(ngModel)]="teacherForm.email" name="teacherEmail" required />
                  </div>
                  <div class="form-group">
                    <label>Phone</label>
                    <input type="tel" class="form-input" [(ngModel)]="teacherForm.phone" name="teacherPhone" />
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label>Gender</label>
                    <select class="form-input" [(ngModel)]="teacherForm.gender" name="teacherGender">
                      <option value="">Select</option>
                      <option value="Male">Male</option>
                      <option value="Female">Female</option>
                      <option value="Other">Other</option>
                    </select>
                  </div>
                </div>
                <div class="form-group">
                  <label>Qualification</label>
                  <textarea class="form-input" [(ngModel)]="teacherForm.qualification" name="teacherQualification" rows="3"></textarea>
                </div>
                <div class="form-group">
                  <label>Experience</label>
                  <textarea class="form-input" [(ngModel)]="teacherForm.experience" name="teacherExperience" rows="3"></textarea>
                </div>
                <div class="form-group">
                  <label>Address</label>
                  <textarea class="form-input" [(ngModel)]="teacherForm.address" name="teacherAddress" rows="3"></textarea>
                </div>

                <!-- Document Upload Section -->
                <div class="documents-section">
                  <h4>Documents</h4>
                  <div class="doc-grid">
                    <div class="doc-item">
                      <label>ID Proof</label>
                      <input type="file" #teacherIdProofInput (change)="onFileSelect($event, 'teacher', 'idProof')" accept="image/*,.pdf" style="display: none;" />
                      <button type="button" class="doc-upload-btn" (click)="teacherIdProofInput.click()">Upload</button>
                      <img *ngIf="teacherForm.idProof" [src]="teacherForm.idProof" class="doc-preview" />
                    </div>
                    <div class="doc-item">
                      <label>Degree Certificate</label>
                      <input type="file" #degreeInput (change)="onFileSelect($event, 'teacher', 'degreeCertificate')" accept="image/*,.pdf" style="display: none;" />
                      <button type="button" class="doc-upload-btn" (click)="degreeInput.click()">Upload</button>
                      <img *ngIf="teacherForm.degreeCertificate" [src]="teacherForm.degreeCertificate" class="doc-preview" />
                    </div>
                    <div class="doc-item">
                      <label>Resume</label>
                      <input type="file" #resumeInput (change)="onFileSelect($event, 'teacher', 'resume')" accept="image/*,.pdf" style="display: none;" />
                      <button type="button" class="doc-upload-btn" (click)="resumeInput.click()">Upload</button>
                      <img *ngIf="teacherForm.resume" [src]="teacherForm.resume" class="doc-preview" />
                    </div>
                    <div class="doc-item">
                      <label>Photo</label>
                      <input type="file" #teacherPhotoInput (change)="onFileSelect($event, 'teacher', 'photo')" accept="image/*" style="display: none;" />
                      <button type="button" class="doc-upload-btn" (click)="teacherPhotoInput.click()">Upload</button>
                      <img *ngIf="teacherForm.photo" [src]="teacherForm.photo" class="doc-preview" />
                    </div>
                  </div>
                </div>

                <div class="form-actions">
                  <button type="button" class="btn-secondary" (click)="resetTeacherForm()">Reset</button>
                  <button type="submit" class="btn-primary" [disabled]="isSubmittingTeacher">
                    {{ isSubmittingTeacher ? 'Submitting...' : 'Submit Application' }}
                  </button>
                </div>
              </form>
            </div>

            <!-- Teacher Admissions List -->
            <div *ngIf="teacherSubTab !== 'new'" class="admission-list-section">
              <div class="admission-list-header">
                <h3>{{ getTeacherSubTabTitle() }}</h3>
                <button class="btn-primary" (click)="teacherSubTab = 'new'">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                  New Onboarding
                </button>
              </div>

              <div *ngIf="isLoadingTeacherAdmissions" class="loading">Loading...</div>
              <div *ngIf="!isLoadingTeacherAdmissions && teacherAdmissions.length === 0" class="empty-state">
                <p>No {{ teacherSubTab }} applications found</p>
              </div>

              <div *ngIf="!isLoadingTeacherAdmissions && teacherAdmissions.length > 0" class="admissions-list">
                <div class="admission-card" *ngFor="let admission of teacherAdmissions">
                  <div class="admission-card-header">
                    <div class="admission-card-title">
                      <div class="admission-avatar">
                        <img *ngIf="admission.photo" [src]="admission.photo" />
                        <span *ngIf="!admission.photo">{{ (admission.firstName && admission.firstName.charAt(0)) || 'T' }}{{ (admission.lastName && admission.lastName.charAt(0)) || '' }}</span>
                      </div>
                      <div>
                        <h4>{{ admission.firstName }} {{ admission.lastName }}</h4>
                        <p>{{ admission.email }}</p>
                      </div>
                    </div>
                    <span class="status-badge" [class]="'status-' + admission.status">{{ admission.status | titlecase }}</span>
                  </div>
                  <div class="admission-card-body">
                    <div class="info-grid">
                      <div class="info-item">
                        <span class="info-label">Qualification:</span>
                        <span class="info-value">{{ admission.qualification || 'N/A' }}</span>
                      </div>
                      <div class="info-item">
                        <span class="info-label">Experience:</span>
                        <span class="info-value">{{ admission.experience || 'N/A' }}</span>
                      </div>
                      <div class="info-item">
                        <span class="info-label">Phone:</span>
                        <span class="info-value">{{ admission.phone || 'N/A' }}</span>
                      </div>
                      <div class="info-item">
                        <span class="info-label">Submitted:</span>
                        <span class="info-value">{{ formatAdmissionDate(admission.submittedAt) }}</span>
                      </div>
                    </div>
                    <div *ngIf="admission.adminRemark" class="remark-section">
                      <strong>Admin Remark:</strong> {{ admission.adminRemark }}
                    </div>
                  </div>
                  <div class="admission-card-actions">
                    <div>
                      <button class="btn-view" (click)="viewTeacherAdmission(admission)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M1 12S5 4 12 4S23 12 23 12S19 20 12 20S1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        View
                      </button>
                      <button class="btn-delete" (click)="deleteTeacherAdmission(admission.id!)" [title]="'Delete admission'">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Delete
                      </button>
                    </div>
                    <div *ngIf="admission.status === 'submitted' || admission.status === 'under_review'">
                      <button class="btn-approve" (click)="approveTeacherAdmission(admission.id!)">
                        ‚úÖ Approve
                      </button>
                      <button class="btn-reject" (click)="rejectTeacherAdmission(admission.id!)">
                        ‚ùå Reject
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Students Tab -->
        <div class="dashboard-section" *ngIf="activeTab === 'students'">
          <div class="section-header">
            <div>
              <h2 class="section-title">Students</h2>
              <p class="section-subtitle">Manage all approved students, view profiles, and update information</p>
            </div>
            <button class="btn-primary" (click)="openAddStudentModal()" *ngIf="false">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              Add Student
            </button>
          </div>

          <!-- Student Status Filters -->
          <div class="student-filters">
            <button class="filter-btn" [class.active]="studentFilter === 'all'" (click)="loadStudents('all')">
              All Students
            </button>
            <button class="filter-btn" [class.active]="studentFilter === 'active'" (click)="loadStudents('active')">
              Active
            </button>
            <button class="filter-btn" [class.active]="studentFilter === 'inactive'" (click)="loadStudents('inactive')">
              Inactive
            </button>
            <button class="filter-btn" [class.active]="studentFilter === 'pass-out'" (click)="loadStudents('pass-out')">
              Pass-out
            </button>
          </div>

          <div class="form-header" style="margin: 16px 0 12px;">
            <h3>Student Filters</h3>
            <button class="btn-secondary" type="button" (click)="showStudentFilters = !showStudentFilters">
              {{ showStudentFilters ? 'Hide Filters' : 'Filter' }}
            </button>
          </div>
          <div *ngIf="showStudentFilters">
            <div class="form-row" style="margin: 0 0 16px;">
              <div class="form-group">
                <label>Student Name</label>
                <select class="form-input" [(ngModel)]="studentSearch.name">
                  <option value="">All</option>
                  <option *ngFor="let name of studentFilterOptions.names" [value]="name">{{ name }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Email</label>
                <select class="form-input" [(ngModel)]="studentSearch.email">
                  <option value="">All</option>
                  <option *ngFor="let email of studentFilterOptions.emails" [value]="email">{{ email }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Roll</label>
                <select class="form-input" [(ngModel)]="studentSearch.roll">
                  <option value="">All</option>
                  <option *ngFor="let roll of studentFilterOptions.rolls" [value]="roll">{{ roll }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Phone</label>
                <select class="form-input" [(ngModel)]="studentSearch.phone">
                  <option value="">All</option>
                  <option *ngFor="let phone of studentFilterOptions.phones" [value]="phone">{{ phone }}</option>
                </select>
              </div>
            </div>
            <div class="form-row" style="margin: 0 0 24px;">
              <div class="form-group">
                <label>Course</label>
                <select class="form-input" [(ngModel)]="studentSearch.course">
                  <option value="">All</option>
                  <option *ngFor="let course of studentFilterOptions.courses" [value]="course">{{ course }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Class/Sem</label>
                <select class="form-input" [(ngModel)]="studentSearch.className">
                  <option value="">All</option>
                  <option *ngFor="let className of studentFilterOptions.classes" [value]="className">{{ className }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Section</label>
                <select class="form-input" [(ngModel)]="studentSearch.section">
                  <option value="">All</option>
                  <option *ngFor="let section of studentFilterOptions.sections" [value]="section">{{ section }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Academic Year</label>
                <select class="form-input" [(ngModel)]="studentSearch.academicYear">
                  <option value="">All</option>
                  <option *ngFor="let year of studentFilterOptions.academicYears" [value]="year">{{ year }}</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Students List -->
          <div class="students-list-section">
            <div *ngIf="isLoadingStudents" class="loading">Loading students...</div>
            <div *ngIf="!isLoadingStudents && students.length === 0 && studentAdmissions.length === 0" class="empty-state">
              <p>No students found</p>
            </div>

            <!-- Approved Students -->
          <div *ngIf="!isLoadingStudents && filteredStudents.length > 0" class="students-grid">
            <div class="student-card" *ngFor="let student of filteredStudents">
                <div class="student-card-header">
                  <div class="student-avatar">
                    <img *ngIf="student.profileImage" [src]="student.profileImage" />
                    <span *ngIf="!student.profileImage">{{ (student.firstName && student.firstName.charAt(0)) || 'S' }}{{ (student.lastName && student.lastName.charAt(0)) || '' }}</span>
                  </div>
                  <div class="student-info">
                    <h3>{{ student.firstName }} {{ student.lastName }}</h3>
                    <p>{{ student.email }}</p>
                    <p *ngIf="student.rollNumber" class="roll-number">Roll: {{ student.rollNumber }}</p>
                  </div>
                  <span class="status-badge" [class]="student.isActive ? 'status-active' : 'status-inactive'">
                    {{ student.isActive ? 'Active' : 'Inactive' }}
                  </span>
                </div>
                <div class="student-card-body">
                  <div class="info-row">
                    <span class="info-label">Course:</span>
                    <span class="info-value">{{ getStudentCourseName(student) }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label">Class:</span>
                    <span class="info-value">{{ getStudentClassName(student) }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label">Section:</span>
                    <span class="info-value">{{ getStudentSectionName(student) }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label">Academic Year:</span>
                    <span class="info-value">{{ student.academicYear || 'N/A' }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label">Phone:</span>
                    <span class="info-value">{{ student.phone || 'N/A' }}</span>
                  </div>
                </div>
                <div class="student-card-actions">
                  <button class="btn-view" (click)="viewStudent(student)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M1 12S5 4 12 4S23 12 23 12S19 20 12 20S1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    View
                  </button>
                  <button class="btn-edit" (click)="editStudent(student)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M18.5 2.5C18.8978 2.10218 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10218 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10218 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Edit
                  </button>
                  <button class="btn-status" (click)="toggleStudentActiveStatus(student)" [title]="student.isActive ? 'Click to deactivate' : 'Click to activate'">
                    Status
                  </button>
                  <button class="btn-delete" (click)="deleteStudent(student)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Delete
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Teachers Tab -->
        <div class="dashboard-section" *ngIf="activeTab === 'teachers'">
          <div class="section-header">
            <div>
              <h2 class="section-title">Teachers</h2>
              <p class="section-subtitle">Manage all onboarded teachers, view profiles, and update information</p>
            </div>
          </div>

          <!-- Teacher Status Filters -->
          <div class="student-filters">
            <button class="filter-btn" [class.active]="teacherFilter === 'all'" (click)="loadTeachers('all')">
              All Teachers
            </button>
            <button class="filter-btn" [class.active]="teacherFilter === 'active'" (click)="loadTeachers('active')">
              Active
            </button>
            <button class="filter-btn" [class.active]="teacherFilter === 'inactive'" (click)="loadTeachers('inactive')">
              Inactive
            </button>
          </div>

          <div class="form-header" style="margin: 16px 0 12px;">
            <h3>Teacher Filters</h3>
            <button class="btn-secondary" type="button" (click)="showTeacherFilters = !showTeacherFilters">
              {{ showTeacherFilters ? 'Hide Filters' : 'Filter' }}
            </button>
          </div>
          <div *ngIf="showTeacherFilters">
            <div class="form-row" style="margin: 0 0 16px;">
              <div class="form-group">
                <label>Teacher Name</label>
                <select class="form-input" [(ngModel)]="teacherSearch.name">
                  <option value="">All</option>
                  <option *ngFor="let name of teacherFilterOptions.names" [value]="name">{{ name }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Email</label>
                <select class="form-input" [(ngModel)]="teacherSearch.email">
                  <option value="">All</option>
                  <option *ngFor="let email of teacherFilterOptions.emails" [value]="email">{{ email }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Employee ID</label>
                <select class="form-input" [(ngModel)]="teacherSearch.employeeId">
                  <option value="">All</option>
                  <option *ngFor="let employeeId of teacherFilterOptions.employeeIds" [value]="employeeId">{{ employeeId }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Phone</label>
                <select class="form-input" [(ngModel)]="teacherSearch.phone">
                  <option value="">All</option>
                  <option *ngFor="let phone of teacherFilterOptions.phones" [value]="phone">{{ phone }}</option>
                </select>
              </div>
            </div>
            <div class="form-row" style="margin: 0 0 24px;">
              <div class="form-group">
                <label>Qualification</label>
                <select class="form-input" [(ngModel)]="teacherSearch.qualification">
                  <option value="">All</option>
                  <option *ngFor="let qualification of teacherFilterOptions.qualifications" [value]="qualification">{{ qualification }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Specialization</label>
                <select class="form-input" [(ngModel)]="teacherSearch.specialization">
                  <option value="">All</option>
                  <option *ngFor="let specialization of teacherFilterOptions.specializations" [value]="specialization">{{ specialization }}</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Teachers List -->
          <div class="students-list-section">
            <div *ngIf="isLoadingTeachers" class="loading">Loading teachers...</div>
            <div *ngIf="!isLoadingTeachers && teachers.length === 0" class="empty-state">
              <p>No teachers found</p>
            </div>

            <!-- Approved Teachers -->
          <div *ngIf="!isLoadingTeachers && filteredTeachers.length > 0" class="students-grid">
            <div class="student-card" *ngFor="let teacher of filteredTeachers">
                <div class="student-card-header">
                  <div class="student-avatar">
                    <img *ngIf="teacher.profileImage" [src]="teacher.profileImage" />
                    <span *ngIf="!teacher.profileImage">{{ (teacher.firstName && teacher.firstName.charAt(0)) || 'T' }}{{ (teacher.lastName && teacher.lastName.charAt(0)) || '' }}</span>
                  </div>
                  <div class="student-info">
                    <h3>{{ teacher.firstName }} {{ teacher.lastName }}</h3>
                    <p>{{ teacher.email }}</p>
                    <p *ngIf="teacher.employeeId" class="roll-number">Employee ID: {{ teacher.employeeId }}</p>
                    <p *ngIf="teacher.qualification" class="roll-number">Qualification: {{ teacher.qualification }}</p>
                  </div>
                  <span class="status-badge" [class]="teacher.isActive ? 'status-active' : 'status-inactive'">
                    {{ teacher.isActive ? 'Active' : 'Inactive' }}
                  </span>
                </div>
                <div class="student-info-grid">
                  <div class="info-item">
                    <span class="info-label">Specialization:</span>
                    <span class="info-value">{{ teacher.specialization || 'N/A' }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">Subjects:</span>
                    <span class="info-value">{{ teacher.subjects || 'Not assigned' }}</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">Phone:</span>
                    <span class="info-value">{{ teacher.phone || 'N/A' }}</span>
                  </div>
                </div>
                <div class="student-actions">
                  <button class="btn-view" (click)="openTeacherDetailsModal(teacher)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M1 12S5 4 12 4S23 12 23 12S19 20 12 20S1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    View
                  </button>
                  <button class="btn-edit" (click)="openEditTeacherModal(teacher)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M18.5 2.5C18.8978 2.10218 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10218 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10218 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Edit
                  </button>
                  <button class="btn-status" (click)="toggleTeacherActiveStatus(teacher)" [title]="teacher.isActive ? 'Click to deactivate' : 'Click to activate'">
                    Status
                  </button>
                  <button class="btn-subjects" (click)="openSubjectAssignmentModal(teacher)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Assign Subjects
                  </button>
                  <button class="btn-delete" (click)="deleteTeacher(teacher)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Delete
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- My Subjects Tab -->
        <div class="dashboard-section" *ngIf="activeTab === 'subjects'">
          <!-- Feature Disabled Message -->
          <div *ngIf="!isFeatureEnabled('My Subjects') && !isFeatureEnabled('subjects')" class="empty-state" style="padding: 60px 20px; text-align: center; min-height: 400px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
            <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin: 0 auto 24px; opacity: 0.6;">
              <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M12 8V12M12 16H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <h2 style="margin: 0 0 12px 0; color: var(--text-primary); font-size: 24px; font-weight: 700;">Access Denied</h2>
            <p style="color: var(--text-gray); margin: 0; font-size: 16px; max-width: 500px;">You don't have access to this feature. The "My Subjects" feature has been disabled for your institution.</p>
            <p style="color: var(--text-gray); margin: 12px 0 0 0; font-size: 14px; opacity: 0.8;">Please contact your administrator to enable this feature.</p>
          </div>
          
          <!-- My Subjects Content (only shown if feature is enabled) -->
          <div *ngIf="isFeatureEnabled('My Subjects') || isFeatureEnabled('subjects')">
            <div class="section-header">
              <div>
                <h2 class="section-title">My Subjects</h2>
                <p class="section-subtitle">Manage courses, classes, subjects, and teacher assignments</p>
              </div>
            </div>

          <!-- Sub-tabs for Course, Class, Subject Management -->
          <div class="admission-sub-tabs">
            <button class="admission-sub-tab" [class.active]="subjectSubTab === 'courses'" (click)="subjectSubTab = 'courses'">
              Courses
            </button>
            <button class="admission-sub-tab" [class.active]="subjectSubTab === 'classes'" (click)="subjectSubTab = 'classes'">
              Classes / Semesters
            </button>
            <button class="admission-sub-tab" [class.active]="subjectSubTab === 'sections'" (click)="subjectSubTab = 'sections'" *ngIf="isFeatureEnabled('Sections')">
              Sections
            </button>
            <button class="admission-sub-tab" [class.active]="subjectSubTab === 'teacher-assignment'" (click)="subjectSubTab = 'teacher-assignment'; loadTeachers('all');">
              Teacher Assignment
            </button>
          </div>

          <!-- Courses Tab -->
          <div *ngIf="subjectSubTab === 'courses'" class="admission-form-section">
            <div class="form-header">
              <h3>Course Management</h3>
              <button class="btn-primary" (click)="openCourseModal()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Create Course
              </button>
            </div>

            <div *ngIf="isLoadingCourses" class="loading">Loading courses...</div>
            <div *ngIf="!isLoadingCourses && courses.length === 0" class="empty-state">
              <p>No courses found. Create your first course to get started.</p>
            </div>

            <div *ngIf="!isLoadingCourses && courses.length > 0" class="courses-grid">
              <div class="course-card" *ngFor="let course of courses">
                <div class="course-card-header">
                  <h4>{{ course.name }}</h4>
                  <span class="status-badge" [class]="'status-' + course.status">
                    {{ course.status }}
                  </span>
                </div>
                <div class="course-card-body">
                  <p><strong>Type:</strong> {{ course.type }}</p>
                  <p *ngIf="course.durationYears"><strong>Duration:</strong> {{ course.durationYears }} years</p>
                  <p *ngIf="course.durationSemesters"><strong>Duration:</strong> {{ course.durationSemesters }} semesters</p>
                </div>
                <div class="course-card-actions">
                  <button class="btn-edit" (click)="editCourse(course)">Edit</button>
                  <button class="btn-delete" (click)="deleteCourse(course.id!)" *ngIf="course.id">Delete</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Classes Tab -->
          <div *ngIf="subjectSubTab === 'classes'" class="admission-form-section">
            <div class="form-header">
              <h3>Class / Semester Management</h3>
              <button class="btn-primary" (click)="openClassModal()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Create Class / Semester
              </button>
            </div>

            <div *ngIf="courses.length === 0" class="empty-state">
              <p>Please create a course first before creating classes/semesters.</p>
            </div>

            <div *ngIf="courses.length > 0" class="form-group">
              <label>Select Course</label>
              <select class="form-input" [(ngModel)]="selectedCourseForClass" (change)="loadClassesForCourse()">
                <option value="">Select a course</option>
                <option *ngFor="let course of courses" [value]="course.id">{{ course.name }}</option>
              </select>
            </div>

            <div *ngIf="isLoadingClasses" class="loading">Loading classes...</div>
            <div *ngIf="!isLoadingClasses && selectedCourseForClass && classes.length === 0" class="empty-state">
              <p>No classes/semesters found for this course.</p>
            </div>

            <div *ngIf="!isLoadingClasses && classes.length > 0" class="classes-grid">
              <div class="class-card" *ngFor="let classItem of classes">
                <div class="class-card-header">
                  <h4>{{ classItem.name }}</h4>
                  <span class="status-badge" [class]="'status-' + classItem.status">
                    {{ classItem.status }}
                  </span>
                </div>
                <div class="class-card-body">
                  <p><strong>Type:</strong> {{ classItem.type }}</p>
                  <p *ngIf="classItem.academicYear"><strong>Academic Year:</strong> {{ classItem.academicYear }}</p>
                </div>
                <div class="class-card-actions">
                  <button class="btn-edit" (click)="editClass(classItem)">Edit</button>
                  <button class="btn-primary" (click)="manageSections(classItem)">Manage Sections</button>
                  <button class="btn-delete" (click)="deleteClass(classItem.id!)" *ngIf="classItem.id">Delete</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Sections Tab -->
          <div *ngIf="subjectSubTab === 'sections'" class="admission-form-section">
            <!-- Feature Disabled Message -->
            <div *ngIf="!isFeatureEnabled('Sections')" class="empty-state" style="padding: 40px; text-align: center;">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin: 0 auto 16px; opacity: 0.5;">
                <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 8V12M12 16H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <h3 style="margin: 0 0 8px 0; color: var(--text-primary);">Sections Feature Disabled</h3>
              <p style="color: var(--text-gray); margin: 0;">This feature has been disabled for your institution. Please contact your administrator to enable it.</p>
            </div>
            
            <!-- Sections Content (only shown if feature is enabled) -->
            <div *ngIf="isFeatureEnabled('Sections')">
              <div class="form-header">
                <h3>Section Management</h3>
                <p style="color: var(--text-gray); font-size: 14px; margin-top: 8px;">
                  Create sections (A, B, C, D, E, etc.) for classes/semesters. Subjects created for a class will automatically be available for ALL sections.
                </p>
              </div>

              <div *ngIf="courses.length === 0" class="empty-state">
                <p>Please create a course and class first before creating sections.</p>
              </div>

              <div *ngIf="courses.length > 0" class="form-row">
                <div class="form-group">
                  <label>Select Course</label>
                  <select class="form-input" [(ngModel)]="selectedCourseForSections" (change)="onCourseChangeForSections()">
                    <option value="">Select a course</option>
                    <option *ngFor="let course of courses" [value]="course.id">{{ course.name }}</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Select Class / Semester</label>
                  <select class="form-input" [(ngModel)]="selectedClassForSectionsTab" [disabled]="!selectedCourseForSections" (change)="onClassChangeForSections()">
                    <option value="">Select a class/semester</option>
                    <option *ngFor="let classItem of classesForSections" [value]="classItem.id">{{ classItem.name }}</option>
                  </select>
                </div>
              </div>

              <!-- Section Creation Form -->
              <div *ngIf="selectedClassForSectionsTab" class="section-management-box" style="margin-top: 24px; padding: 20px; background: rgba(255,255,255,0.02); border-radius: 12px; border: 1px solid var(--border-gray);">
              <div class="form-header" style="margin-bottom: 20px;">
                <h4 style="margin: 0;">Add New Section for {{ getClassNameForSections() }}</h4>
                <button class="btn-primary" (click)="sectionForm = { classId: selectedClassForSectionsTab, status: 'active' }; isEditingSection = false">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                  Add Section
                </button>
              </div>

              <!-- Section Form (for both create and edit) -->
              <div *ngIf="sectionForm.classId" class="form-row">
                <div class="form-group">
                  <label>Section Name *</label>
                  <input type="text" class="form-input" [(ngModel)]="sectionForm.name" placeholder="e.g., A, B, C, D, E" />
                </div>
                <div class="form-group">
                  <label>Capacity (Optional)</label>
                  <input type="number" class="form-input" [(ngModel)]="sectionForm.capacity" placeholder="Max students" />
                </div>
              </div>
              <div *ngIf="sectionForm.classId" class="form-group" style="margin-top: 12px;">
                <label>Status</label>
                <select class="form-input" [(ngModel)]="sectionForm.status">
                  <option value="active">Active</option>
                  <option value="inactive">Inactive</option>
                </select>
              </div>
              <div *ngIf="sectionForm.classId" class="form-actions" style="margin-top: 16px;">
                <button class="btn-primary" (click)="saveSection()">{{ isEditingSection ? 'Update Section' : 'Save Section' }}</button>
                <button class="btn-secondary" (click)="cancelSectionEdit()">Cancel</button>
              </div>

              <!-- Existing Sections List -->
              <div *ngIf="sectionsForSectionsTab.length > 0 && !isEditingSection && isFeatureEnabled('Sections')" style="margin-top: 24px;">
                <h4 style="margin-bottom: 16px;">Existing Sections</h4>
                <div class="sections-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;">
                  <div class="section-card" *ngFor="let section of sectionsForSectionsTab" style="padding: 16px; background: rgba(255,255,255,0.03); border: 1px solid var(--border-gray); border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                      <span style="font-weight: 700; font-size: 18px;">{{ section.name }}</span>
                      <span class="status-badge" [class]="'status-' + section.status">{{ section.status }}</span>
                    </div>
                    <p *ngIf="section.capacity" style="color: var(--text-gray); font-size: 13px; margin: 8px 0;">
                      <span *ngIf="getSectionStudentCount(section.id!) !== null">
                        Capacity: {{ getSectionStudentCount(section.id!) }}/{{ section.capacity }} students
                        <span *ngIf="getRemainingCapacity(section) >= 0" style="color: var(--accent-green); font-weight: 700;">
                          (Remaining: {{ getRemainingCapacity(section) }})
                        </span>
                        <span *ngIf="getRemainingCapacity(section) < 0" style="color: #ef4444; font-weight: 700;">
                          (FULL)
                        </span>
                      </span>
                      <span *ngIf="getSectionStudentCount(section.id!) === null">
                        Capacity: {{ section.capacity }} students
                      </span>
                    </p>
                    <div style="display: flex; gap: 8px; margin-top: 12px;">
                      <button class="btn-view" (click)="viewSectionStudents(section)" style="flex: 1; display: flex; align-items: center; justify-content: center; gap: 4px;" title="View Students">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M1 12C1 12 5 4 12 4C19 4 23 12 23 12C23 12 19 20 12 20C5 20 1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        View
                      </button>
                      <button class="btn-edit" (click)="editSection(section)" style="flex: 1;">Edit</button>
                      <button class="btn-delete" (click)="deleteSection(section.id!)" *ngIf="section.id" style="flex: 1;">Delete</button>
                    </div>
                  </div>
                </div>
              </div>

              <div *ngIf="selectedClassForSectionsTab && sectionsForSectionsTab.length === 0 && !isLoadingSectionsForTab" class="empty-state" style="margin-top: 24px;">
                <p>No sections created yet. Add your first section (e.g., A, B, C) for this class.</p>
              </div>

              <div *ngIf="isLoadingSectionsForTab" class="loading" style="margin-top: 24px;">Loading sections...</div>
            </div>

            <div *ngIf="!selectedClassForSectionsTab && courses.length > 0" class="empty-state" style="margin-top: 24px;">
              <p>Please select a course and class/semester to manage sections.</p>
            </div>
          </div>

          </div>

          <!-- Teacher Assignment Tab -->
          <div *ngIf="isTeacherAssignmentTab()" class="admission-form-section">
            <div class="form-header">
              <h3>Teacher Assignment</h3>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Select Subject</label>
                <select class="form-input" [(ngModel)]="selectedSubjectForAssignment" (change)="loadTeachersForSubject()">
                  <option value="">Select a subject</option>
                  <option *ngFor="let subject of allSubjects" [value]="subject.id">
                    {{ subject.name }} ({{ subject.subjectCode }})
                  </option>
                </select>
              </div>
              <div class="form-group">
                <label>Select Section (Optional)</label>
                <select class="form-input" [(ngModel)]="selectedSectionForAssignment" (change)="onSectionForAssignmentChange()" [disabled]="!selectedSubjectForAssignment || sectionsForAssignment.length === 0">
                  <option value="">All Sections</option>
                  <option *ngFor="let section of sectionsForAssignment" [value]="section.id">
                    {{ section.name }}
                  </option>
                </select>
                <small class="form-hint" *ngIf="selectedSubjectForAssignment && sectionsForAssignment.length === 0" style="color: #f59e0b;">
                  ‚ö†Ô∏è No sections found for this subject's class. Create sections first.
                </small>
                <small class="form-hint" *ngIf="selectedSubjectForAssignment && sectionsForAssignment.length > 0">
                  üìå Select a specific section (e.g., A, B, C) or leave as "All Sections" to assign for all sections.
                </small>
              </div>
            </div>

            <div class="form-group">
              <label>Select Teacher</label>
              <select class="form-input" [(ngModel)]="selectedTeacherForAssignment" [disabled]="isLoadingTeachers">
                <option value="">{{ isLoadingTeachers ? 'Loading teachers...' : 'Select a teacher' }}</option>
                <option *ngFor="let teacher of filteredTeachersForAssignment" [value]="teacher.id">
                  {{ teacher.firstName }} {{ teacher.lastName }}
                </option>
              </select>
              <small class="form-hint" *ngIf="!isLoadingTeachers && teachers.length === 0" style="color: #f59e0b; margin-top: 8px; display: block;">
                ‚ö†Ô∏è No teachers found. Please add teachers first from the Teachers tab.
              </small>
              <small class="form-hint" *ngIf="!isLoadingTeachers && teachers.length > 0" style="color: var(--text-gray); margin-top: 8px; display: block;">
                üìå {{ teachers.length }} teacher(s) available
              </small>
            </div>

            <div class="form-actions">
              <button class="btn-primary" (click)="assignTeacherToSubject()" [disabled]="!selectedSubjectForAssignment || !selectedTeacherForAssignment">
                Assign Teacher
              </button>
            </div>

            <div *ngIf="isLoadingTeacherAssignments" class="loading">Loading assignments...</div>
            <div *ngIf="!isLoadingTeacherAssignments && filteredTeacherAssignments.length > 0" class="assignments-list">
              <h4>Current Assignments</h4>
              <div class="assignment-card" *ngFor="let assignment of filteredTeacherAssignments">
                <div class="assignment-info">
                  <p><strong>Subject:</strong> {{ getSubjectName(assignment.subjectId) }}</p>
                  <p><strong>Teacher:</strong> {{ getTeacherName(assignment.teacherId) }}</p>
                  <p><strong>Section:</strong> {{ assignment.sectionId ? getSectionName(assignment.sectionId) : 'All Sections' }}</p>
                </div>
                <button class="btn-delete" (click)="removeTeacherAssignment(assignment.id!)" *ngIf="assignment.id">Remove</button>
              </div>
            </div>
          </div>

          </div>
        </div>

        <!-- Subject List Tab -->
        <div class="dashboard-section" *ngIf="isSubjectListTab()">
              <div class="section-header">
                <div>
                  <h2 class="section-title">Subject List</h2>
                  <p class="section-subtitle">Create and manage subjects for your institution</p>
                </div>
              </div>

          <div class="form-header" style="margin: 16px 0 12px;">
            <h3>Subject Filters</h3>
            <button class="btn-secondary" type="button" (click)="showSubjectFilters = !showSubjectFilters">
              {{ showSubjectFilters ? 'Hide Filters' : 'Filter' }}
            </button>
          </div>
          <div *ngIf="showSubjectFilters">
            <div class="form-row" style="margin: 0 0 16px;">
              <div class="form-group">
                <label>Subject Name</label>
                <select class="form-input" [(ngModel)]="subjectSearch.name">
                  <option value="">All</option>
                  <option *ngFor="let name of subjectFilterOptions.names" [value]="name">{{ name }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Code</label>
                <select class="form-input" [(ngModel)]="subjectSearch.code">
                  <option value="">All</option>
                  <option *ngFor="let code of subjectFilterOptions.codes" [value]="code">{{ code }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Type</label>
                <select class="form-input" [(ngModel)]="subjectSearch.type">
                  <option value="">All</option>
                  <option *ngFor="let type of subjectFilterOptions.types" [value]="type">{{ type }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Status</label>
                <select class="form-input" [(ngModel)]="subjectSearch.status">
                  <option value="">All</option>
                  <option *ngFor="let status of subjectFilterOptions.statuses" [value]="status">{{ status }}</option>
                </select>
              </div>
            </div>
            <div class="form-row" style="margin: 0 0 24px;">
              <div class="form-group">
                <label>Course</label>
                <select class="form-input" [(ngModel)]="subjectSearch.course">
                  <option value="">All</option>
                  <option *ngFor="let course of subjectFilterOptions.courses" [value]="course">{{ course }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Class/Sem</label>
                <select class="form-input" [(ngModel)]="subjectSearch.className">
                  <option value="">All</option>
                  <option *ngFor="let className of subjectFilterOptions.classes" [value]="className">{{ className }}</option>
                </select>
              </div>
            </div>
          </div>

          <div class="form-header">
            <h3>Subject Management</h3>
            <button class="btn-primary" (click)="openSubjectModal()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              Create Subject
            </button>
          </div>

          <div *ngIf="isLoadingSubjectList" class="loading">Loading subjects...</div>
          <div *ngIf="!isLoadingSubjectList && subjectList.length === 0" class="empty-state">
            <p>No subjects found. Create your first subject to get started.</p>
            <button class="btn-primary" (click)="openSubjectModal()" style="margin-top: 15px;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              Create Your First Subject
            </button>
          </div>

          <div *ngIf="!isLoadingSubjectList && filteredSubjectList.length > 0" class="courses-grid">
            <div class="course-card" *ngFor="let subject of filteredSubjectList">
              <div class="course-card-header">
                <h4>{{ subject.name }}</h4>
                <span class="status-badge" [class]="'status-' + subject.status">
                  {{ subject.status }}
                </span>
              </div>
              <div class="course-card-body">
                <p><strong>Code:</strong> {{ subject.subjectCode }}</p>
                <p><strong>Type:</strong> {{ subject.subjectType }}</p>
                <p><strong>Course:</strong> {{ getCourseName(subject.courseId) }}</p>
                <p><strong>Class:</strong> {{ getClassName(subject.classId) }}</p>
                <p><strong>Sections:</strong> {{ getSectionNamesForClass(subject.classId) }}</p>
                <p *ngIf="subject.maxMarks"><strong>Max Marks:</strong> {{ subject.maxMarks }}</p>
                <p *ngIf="subject.credits"><strong>Credits:</strong> {{ subject.credits }}</p>
              </div>
              <div class="course-card-actions">
                <button class="btn-view" (click)="viewSubjectStudents(subject)">View</button>
                <button class="btn-edit" (click)="editSubject(subject)">Edit</button>
                <button class="btn-delete" (click)="deleteSubject(subject.id!)" *ngIf="subject.id">Delete</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Syllabus & Materials Tab -->
        <div class="dashboard-section" *ngIf="isSyllabusMaterialsTab()">
          <div class="syllabus-layout">
            <div class="syllabus-left">
              <div class="section-header">
                <div>
                  <h2 class="section-title">Syllabus & Materials</h2>
                  <p class="section-subtitle">Upload syllabus, videos, notes, and PPTs</p>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Subject *</label>
                  <select class="form-input" [(ngModel)]="selectedSubjectForContentId" (change)="onSubjectContentSubjectChange()">
                    <option value="">Select subject</option>
                    <option *ngFor="let subject of subjectList" [value]="subject.id">
                      {{ subject.subjectCode }} - {{ subject.name }}
                    </option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Type *</label>
                  <select class="form-input" [(ngModel)]="subjectContentForm.type">
                    <option *ngFor="let type of subjectContentTypes" [value]="type">{{ type }}</option>
                  </select>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Title *</label>
                  <input class="form-input" [(ngModel)]="subjectContentForm.title" placeholder="Title" />
                </div>
                <div class="form-group">
                  <label>Unit / Chapter</label>
                  <input class="form-input" [(ngModel)]="subjectContentForm.unit" placeholder="Unit / Chapter" />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Topic</label>
                  <input class="form-input" [(ngModel)]="subjectContentForm.topicName" placeholder="Topic name" />
                </div>
                <div class="form-group">
                  <label>Section (optional)</label>
                  <select class="form-input" [(ngModel)]="subjectContentForm.sectionId" [disabled]="!subjectContentForm.classId">
                    <option value="">All Sections</option>
                    <option *ngFor="let section of subjectListSectionsByClass[subjectContentForm.classId || 0] || []" [value]="section.id">{{ section.name }}</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label>Description</label>
                <textarea class="form-input" rows="3" [(ngModel)]="subjectContentForm.description" placeholder="Description"></textarea>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Upload File (PDF/PPT/Video)</label>
                  <input type="file" class="form-input" (change)="onSubjectContentFileSelect($event)" accept=".pdf,.ppt,.pptx,video/*" />
                  <small class="form-hint" *ngIf="subjectContentForm.fileName">Selected: {{ subjectContentForm.fileName }}</small>
                </div>
                <div class="form-group">
                  <label>Video / Link URL</label>
                  <input class="form-input" [(ngModel)]="subjectContentForm.linkUrl" placeholder="YouTube / Drive link" />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Visible to Students</label>
                  <select class="form-input" [(ngModel)]="subjectContentForm.visibleToStudents">
                    <option [ngValue]="true">Yes</option>
                    <option [ngValue]="false">No</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Visible to Parents</label>
                  <select class="form-input" [(ngModel)]="subjectContentForm.visibleToParents">
                    <option [ngValue]="true">Yes</option>
                    <option [ngValue]="false">No</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Teacher Edit Allowed</label>
                  <select class="form-input" [(ngModel)]="subjectContentForm.teacherEditable">
                    <option [ngValue]="true">Yes</option>
                    <option [ngValue]="false">No</option>
                  </select>
                </div>
              </div>

              <div class="form-actions" style="margin-top: 8px;">
                <button class="btn-primary" (click)="submitSubjectContent()">Upload</button>
                <button class="btn-secondary" (click)="resetSubjectContentForm()">Reset</button>
              </div>
            </div>

            <div class="syllabus-right">
              <div class="form-header" style="margin: 0 0 12px;">
                <h3>Uploaded Content</h3>
                <button class="btn-secondary" type="button" (click)="showContentFilters = !showContentFilters">
                  {{ showContentFilters ? 'Hide Filters' : 'Filter' }}
                </button>
              </div>

              <div *ngIf="showContentFilters" class="form-row" style="margin: 0 0 16px;">
                <div class="form-group">
                  <label>Subject</label>
                  <select class="form-input" [(ngModel)]="contentSearch.subjectId" (change)="onContentSubjectFilterChange()">
                    <option value="">All</option>
                    <option *ngFor="let subject of subjectList" [value]="subject.id">
                      {{ subject.subjectCode }} - {{ subject.name }}
                    </option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Type</label>
                  <select class="form-input" [(ngModel)]="contentSearch.type">
                    <option value="">All</option>
                    <option *ngFor="let type of contentFilterOptions.types" [value]="type">{{ type }}</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Unit</label>
                  <select class="form-input" [(ngModel)]="contentSearch.unit">
                    <option value="">All</option>
                    <option *ngFor="let unit of contentFilterOptions.units" [value]="unit">{{ unit }}</option>
                  </select>
                </div>
              </div>
              <div *ngIf="showContentFilters" class="form-row" style="margin: 0 0 16px;">
                <div class="form-group">
                  <label>Topic</label>
                  <select class="form-input" [(ngModel)]="contentSearch.topic">
                    <option value="">All</option>
                    <option *ngFor="let topic of contentFilterOptions.topics" [value]="topic">{{ topic }}</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Visibility (Students)</label>
                  <select class="form-input" [(ngModel)]="contentSearch.visibleStudents">
                    <option value="">All</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Visibility (Parents)</label>
                  <select class="form-input" [(ngModel)]="contentSearch.visibleParents">
                    <option value="">All</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                  </select>
                </div>
              </div>
              <div *ngIf="showContentFilters" class="form-row" style="margin: 0 0 16px;">
                <div class="form-group">
                  <label>Status</label>
                  <select class="form-input" [(ngModel)]="contentSearch.status">
                    <option value="">All</option>
                    <option *ngFor="let status of contentFilterOptions.statuses" [value]="status">{{ status }}</option>
                  </select>
                </div>
              </div>

              <div *ngIf="isLoadingSubjectContents" class="loading">Loading content...</div>
              <div *ngIf="!isLoadingSubjectContents && filteredSubjectContents.length === 0" class="empty-state">
                <p>No content uploaded for this subject.</p>
              </div>
              <div *ngIf="!isLoadingSubjectContents && filteredSubjectContents.length > 0" class="attendance-summary-table study-material-table">
                <div class="summary-table-header study-material-header">
                  <span>Type</span>
                  <span>Title</span>
                  <span>Unit</span>
                  <span>Topic</span>
                  <span>File/Link</span>
                  <span>Visibility</span>
                  <span>Actions</span>
                  </div>
                <div class="summary-table-row study-material-row" *ngFor="let content of filteredSubjectContents">
                  <span>
                    <span class="status-badge" style="background: rgba(59, 130, 246, 0.15); border: 1px solid rgba(59, 130, 246, 0.3); color: #3b82f6; padding: 4px 12px; border-radius: 6px; font-size: 12px; font-weight: 700; text-transform: uppercase;">
                      {{ content.type }}
                    </span>
                  </span>
                  <span class="summary-name">{{ content.title }}</span>
                  <span>{{ content.unit || 'N/A' }}</span>
                  <span>{{ content.topicName || 'N/A' }}</span>
                  <span>
                    <a *ngIf="content.linkUrl" [href]="content.linkUrl" target="_blank" (click)="$event.stopPropagation()" style="color: var(--accent-green); text-decoration: none; font-weight: 700;">Open Link</a>
                    <a *ngIf="content.fileUrl && !content.fileData" [href]="content.fileUrl" target="_blank" (click)="$event.stopPropagation()" style="color: var(--accent-green); text-decoration: none; font-weight: 700;">Open File</a>
                    <a *ngIf="content.fileData" [href]="content.fileData" [download]="content.fileName || 'file'" (click)="$event.stopPropagation()" style="color: var(--accent-green); text-decoration: none; font-weight: 700;">Download</a>
                    <span *ngIf="!content.linkUrl && !content.fileUrl && !content.fileData && content.fileName" style="color: var(--text-gray);">{{ content.fileName }}</span>
                    <span *ngIf="!content.linkUrl && !content.fileUrl && !content.fileData && !content.fileName" style="color: var(--text-gray);">N/A</span>
                  </span>
                  <span style="display: flex; flex-direction: column; gap: 6px;">
                    <span style="display: flex; align-items: center; gap: 8px;">
                      <span style="color: var(--text-gray); font-size: 12px; font-weight: 600;">Students:</span>
                      <span [style.color]="content.visibleToStudents ? 'var(--accent-green)' : '#ef4444'" style="font-weight: 700; font-size: 13px;">
                        {{ content.visibleToStudents ? 'Yes' : 'No' }}
                      </span>
                    </span>
                    <span style="display: flex; align-items: center; gap: 8px;">
                      <span style="color: var(--text-gray); font-size: 12px; font-weight: 600;">Parents:</span>
                      <span [style.color]="content.visibleToParents ? 'var(--accent-green)' : '#ef4444'" style="font-weight: 700; font-size: 13px;">
                        {{ content.visibleToParents ? 'Yes' : 'No' }}
                      </span>
                    </span>
                  </span>
                  <span style="display: flex; gap: 8px; flex-wrap: wrap;">
                    <button class="btn-view" style="padding: 6px 12px; font-size: 12px;" (click)="openSubjectContentView(content)">View</button>
                    <button class="btn-edit" style="padding: 6px 12px; font-size: 12px;" (click)="openSubjectContentEdit(content)">Edit</button>
                    <button class="btn-delete" style="padding: 6px 12px; font-size: 12px;" (click)="deleteSubjectContent(content)" *ngIf="content.id">Delete</button>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Assignments Tab -->
        <div class="dashboard-section" *ngIf="activeTab === 'assignments'">
          <div class="section-header">
            <div>
              <h2 class="section-title">Assignments</h2>
              <p class="section-subtitle">Admin overview, tracking, and controls</p>
            </div>
          </div>

          <div class="overview-grid">
            <div class="stat-card">
              <div class="stat-label">Total assignments</div>
              <div class="stat-value">{{ assignmentOverview?.totalAssignments || 0 }}</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Pending evaluations</div>
              <div class="stat-value">{{ assignmentOverview?.pendingEvaluations || 0 }}</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Overdue assignments</div>
              <div class="stat-value">{{ assignmentOverview?.overdueAssignments || 0 }}</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Submission %</div>
              <div class="stat-value">{{ (assignmentOverview?.submissionPercentage || 0) | number:'1.0-1' }}%</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Late submissions</div>
              <div class="stat-value">{{ assignmentOverview?.lateSubmissions || 0 }}</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Feedback submitted</div>
              <div class="stat-value">{{ assignmentOverview?.feedbackCount || 0 }}</div>
            </div>
          </div>

          <div class="form-header" style="margin-top: 16px;">
            <h3>Assignment Filters</h3>
            <div style="display: flex; gap: 8px;">
              <button class="btn-secondary" type="button" (click)="showAssignmentFilters = !showAssignmentFilters">
                {{ showAssignmentFilters ? 'Hide Filters' : 'Filter' }}
              </button>
              <button class="btn-secondary" type="button" (click)="exportAssignmentsCsv()">Export Excel</button>
              <button class="btn-secondary" type="button" (click)="exportAssignmentsPdf()">Export PDF</button>
            </div>
          </div>

          <div *ngIf="showAssignmentFilters">
            <div class="form-row" style="margin: 0 0 16px;">
              <div class="form-group">
                <label>Course</label>
                <select class="form-input" [(ngModel)]="assignmentFilters.courseId" (change)="onAssignmentCourseChange()">
                  <option value="">All</option>
                  <option *ngFor="let course of courses" [value]="course.id">{{ course.name }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Class / Semester</label>
                <select class="form-input" [(ngModel)]="assignmentFilters.classId" (change)="onAssignmentClassChange()">
                  <option value="">All</option>
                  <option *ngFor="let classItem of assignmentFilterClasses" [value]="classItem.id">{{ classItem.name }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Section</label>
                <select class="form-input" [(ngModel)]="assignmentFilters.sectionId">
                  <option value="">All</option>
                  <option *ngFor="let section of assignmentFilterSections" [value]="section.id">{{ section.name }}</option>
                </select>
              </div>
            </div>
            <div class="form-row" style="margin: 0 0 16px;">
              <div class="form-group">
                <label>Subject</label>
                <select class="form-input" [(ngModel)]="assignmentFilters.subjectId">
                  <option value="">All</option>
                  <option *ngFor="let subject of allSubjects" [value]="subject.id">{{ subject.subjectCode }} - {{ subject.name }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Teacher</label>
                <select class="form-input" [(ngModel)]="assignmentFilters.teacherId">
                  <option value="">All</option>
                  <option *ngFor="let teacher of teachers" [value]="teacher.id">{{ teacher.firstName }} {{ teacher.lastName }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Status</label>
                <select class="form-input" [(ngModel)]="assignmentFilters.status">
                  <option value="">All</option>
                  <option value="active">active</option>
                  <option value="closed">closed</option>
                  <option value="hidden">hidden</option>
                </select>
              </div>
            </div>
            <div class="form-row" style="margin: 0 0 16px;">
              <div class="form-group">
                <label>From Date</label>
                <input type="date" class="form-input" [(ngModel)]="assignmentFilters.fromDate" />
              </div>
              <div class="form-group">
                <label>To Date</label>
                <input type="date" class="form-input" [(ngModel)]="assignmentFilters.toDate" />
              </div>
            </div>
            <div class="form-actions" style="margin-bottom: 16px;">
              <button class="btn-primary" (click)="applyAssignmentFilters()">Apply Filters</button>
              <button class="btn-secondary" (click)="resetAssignmentFilters()">Reset</button>
            </div>
          </div>

          <div *ngIf="isLoadingAssignmentOverview || isLoadingAdminAssignments" class="loading">Loading assignments...</div>

          <div *ngIf="!isLoadingAdminAssignments && adminAssignments.length === 0" class="empty-state">
            <p>No assignments found for the selected filters.</p>
          </div>

          <div *ngIf="!isLoadingAdminAssignments && adminAssignments.length > 0" class="attendance-summary-table">
            <div class="summary-table-header">
              <span>Title</span>
              <span>Subject</span>
              <span>Class</span>
              <span>Teacher</span>
              <span>Due Date</span>
              <span>Status</span>
              <span>Submissions</span>
              <span>Actions</span>
              </div>
            <div class="summary-table-row" *ngFor="let assignment of adminAssignments">
              <span class="summary-name">{{ assignment.title }}</span>
              <span>{{ getSubjectName(assignment.subjectId || 0) }}</span>
              <span>{{ getClassName(assignment.classId || 0) }}</span>
              <span>{{ assignment.teacherId ? getTeacherName(assignment.teacherId) : 'N/A' }}</span>
              <span>{{ assignment.extendedDueDate || assignment.dueDate || 'N/A' }}</span>
              <span>
                <span class="status-badge" [class.status-active]="assignment.status === 'active'"
                      [class.status-closed]="assignment.status === 'closed'">
                  {{ assignment.status || 'active' }}
                </span>
              </span>
              <span>
                {{ assignment.submittedCount || 0 }}/{{ assignment.totalStudents || 0 }}
                <span style="color: var(--text-gray); font-size: 12px;">
                  (P: {{ assignment.pendingCount || 0 }}, L: {{ assignment.lateSubmissions || 0 }})
                </span>
              </span>
              <span style="display: flex; gap: 8px; flex-wrap: wrap;">
                <button class="btn-secondary" style="padding: 6px 12px; font-size: 12px;" (click)="extendAssignmentDueDate(assignment)">Extend</button>
                <button class="btn-secondary" style="padding: 6px 12px; font-size: 12px;" (click)="toggleAssignmentLock(assignment)">
                  {{ assignment.lockAfterDueDate ? 'Unlock' : 'Lock' }}
                </button>
                <button class="btn-delete" style="padding: 6px 12px; font-size: 12px;" (click)="updateAssignmentStatus(assignment, 'hidden')">Hide</button>
              </span>
            </div>
          </div>

          <div class="overview-grid" style="margin-top: 16px;" *ngIf="assignmentOverview">
            <div class="stat-card">
              <div class="stat-label">Syllabus aligned</div>
              <div class="stat-value">{{ assignmentOverview.syllabusAlignedCount || 0 }}</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Quality checks</div>
              <div class="stat-value">
                <span *ngFor="let item of assignmentOverview.qualityCheckCounts | keyvalue">
                  {{ item.key }}: {{ item.value }}&nbsp;
                </span>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Assignments per subject</div>
              <div class="stat-value">
                <span *ngFor="let item of assignmentOverview.assignmentFrequencyBySubject | keyvalue">
                  {{ getSubjectName(item.key) }}: {{ item.value }}&nbsp;
                </span>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Avg marks per subject</div>
              <div class="stat-value">
                <span *ngFor="let item of assignmentOverview.averageMarksBySubject | keyvalue">
                  {{ getSubjectName(item.key) }}: {{ item.value | number:'1.0-1' }}&nbsp;
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Attendance Tab -->
        <div class="dashboard-section" *ngIf="activeTab === 'attendance'">
          <div class="section-header">
            <div>
              <h2 class="section-title">Attendance</h2>
              <p class="section-subtitle">Admin overview, alerts, and policy controls</p>
            </div>
          </div>

          <div class="overview-grid">
            <div class="stat-card">
              <div class="stat-label">Overall attendance %</div>
              <div class="stat-value">{{ (attendanceOverview?.attendancePercentage || 0) | number:'1.0-1' }}%</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Pending entries</div>
              <div class="stat-value">{{ attendanceOverview?.pendingEntries || 0 }}</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Today sessions</div>
              <div class="stat-value">{{ attendanceOverview?.todaySessions || 0 }}</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Late / missed logs</div>
              <div class="stat-value">{{ attendanceOverview?.lateCount || 0 }} / {{ attendanceOverview?.missedCount || 0 }}</div>
            </div>
          </div>

          <div class="form-header" style="margin-top: 16px;">
            <h3>Attendance Filters</h3>
            <div style="display: flex; gap: 8px;">
              <button class="btn-secondary" type="button" (click)="showAttendanceFilters = !showAttendanceFilters">
                {{ showAttendanceFilters ? 'Hide Filters' : 'Filter' }}
              </button>
              <button class="btn-secondary" type="button" (click)="exportAttendanceReportsCsv()">Export Excel</button>
              <button class="btn-secondary" type="button" (click)="exportAttendanceReportsPdf()">Export PDF</button>
            </div>
          </div>

          <div *ngIf="showAttendanceFilters">
            <div class="form-row" style="margin: 0 0 16px;">
              <div class="form-group">
                <label>Course</label>
                <select class="form-input" [(ngModel)]="attendanceFilters.courseId" (change)="onAttendanceCourseChange()">
                  <option value="">All</option>
                  <option *ngFor="let course of courses" [value]="course.id">{{ course.name }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Class / Semester</label>
                <select class="form-input" [(ngModel)]="attendanceFilters.classId" (change)="onAttendanceClassChange()">
                  <option value="">All</option>
                  <option *ngFor="let classItem of attendanceFilterClasses" [value]="classItem.id">{{ classItem.name }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Section</label>
                <select class="form-input" [(ngModel)]="attendanceFilters.sectionId">
                  <option value="">All</option>
                  <option *ngFor="let section of attendanceFilterSections" [value]="section.id">{{ section.name }}</option>
                </select>
              </div>
            </div>
            <div class="form-row" style="margin: 0 0 16px;">
              <div class="form-group">
                <label>Subject</label>
                <select class="form-input" [(ngModel)]="attendanceFilters.subjectId">
                  <option value="">All</option>
                  <option *ngFor="let subject of allSubjects" [value]="subject.id">{{ subject.subjectCode }} - {{ subject.name }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Teacher</label>
                <select class="form-input" [(ngModel)]="attendanceFilters.teacherId">
                  <option value="">All</option>
                  <option *ngFor="let teacher of teachers" [value]="teacher.id">{{ teacher.firstName }} {{ teacher.lastName }}</option>
                </select>
              </div>
            </div>
            <div class="form-row" style="margin: 0 0 16px;">
              <div class="form-group">
                <label>From Date</label>
                <input type="date" class="form-input" [(ngModel)]="attendanceFilters.fromDate" />
              </div>
              <div class="form-group">
                <label>To Date</label>
                <input type="date" class="form-input" [(ngModel)]="attendanceFilters.toDate" />
              </div>
            </div>
            <div class="form-actions" style="margin-bottom: 16px;">
              <button class="btn-primary" (click)="applyAttendanceFilters()">Apply Filters</button>
              <button class="btn-secondary" (click)="resetAttendanceFilters()">Reset</button>
            </div>
          </div>

          <div class="form-header" style="margin-top: 16px;">
            <h3>Class / Section Summary</h3>
          </div>
          <div *ngIf="attendanceOverview?.classSummary?.length === 0" class="empty-state">
            <p>No attendance summaries available.</p>
              </div>
          <div *ngIf="attendanceOverview?.classSummary?.length" class="attendance-summary-table">
            <div class="summary-table-header">
              <span>Class</span>
              <span>Present</span>
              <span>Total</span>
              <span>Attendance</span>
            </div>
            <div class="summary-table-row" *ngFor="let summary of attendanceOverview?.classSummary">
              <span class="summary-name">{{ getClassName(summary.classId) }}</span>
              <span class="summary-present">{{ summary.presentEntries }}</span>
              <span class="summary-total">{{ summary.totalEntries }}</span>
              <span>
                <span class="summary-percent"
                      [style.color]="summary.percent >= 75 ? 'var(--accent-green)' : '#f59e0b'">
                  {{ summary.percent | number:'1.0-1' }}%
                </span>
              </span>
          </div>
          </div>

          <div class="form-header" style="margin-top: 32px;">
            <h3>Section Summary</h3>
          </div>
          <div *ngIf="attendanceOverview?.sectionSummary?.length === 0" class="empty-state">
            <p>No section summaries available.</p>
              </div>
          <div *ngIf="attendanceOverview?.sectionSummary?.length" class="attendance-summary-table">
            <div class="summary-table-header">
              <span>Section</span>
              <span>Present</span>
              <span>Total</span>
              <span>Attendance</span>
            </div>
            <div class="summary-table-row" *ngFor="let summary of attendanceOverview?.sectionSummary">
              <span class="summary-name">{{ getSectionName(summary.sectionId) }}</span>
              <span class="summary-present">{{ summary.presentEntries }}</span>
              <span class="summary-total">{{ summary.totalEntries }}</span>
              <span>
                <span class="summary-percent"
                      [style.color]="summary.percent >= 75 ? 'var(--accent-green)' : '#f59e0b'">
                  {{ summary.percent | number:'1.0-1' }}%
                </span>
              </span>
          </div>
          </div>

          <div class="form-header" style="margin-top: 32px;">
            <h3>Subject Summary</h3>
          </div>
          <div *ngIf="attendanceOverview?.subjectSummary?.length === 0" class="empty-state">
            <p>No subject summaries available.</p>
              </div>
          <div *ngIf="attendanceOverview?.subjectSummary?.length" class="attendance-summary-table">
            <div class="summary-table-header">
              <span>Subject</span>
              <span>Present</span>
              <span>Total</span>
              <span>Attendance</span>
            </div>
            <div class="summary-table-row" *ngFor="let summary of attendanceOverview?.subjectSummary">
              <span class="summary-name">{{ getSubjectName(summary.subjectId) }}</span>
              <span class="summary-present">{{ summary.presentEntries }}</span>
              <span class="summary-total">{{ summary.totalEntries }}</span>
              <span>
                <span class="summary-percent"
                      [style.color]="summary.percent >= 75 ? 'var(--accent-green)' : '#f59e0b'">
                  {{ summary.percent | number:'1.0-1' }}%
                </span>
              </span>
          </div>
          </div>

          <div class="form-header" style="margin-top: 16px;">
            <h3>Low Attendance Alerts</h3>
          </div>
          <div *ngIf="attendanceOverview?.lowAttendanceAlerts?.length" class="assignments-list">
            <div class="assignment-card" *ngFor="let alert of attendanceOverview?.lowAttendanceAlerts">
              <div class="assignment-info">
                <p><strong>Student ID:</strong> {{ alert.studentId }}</p>
                <p>Attendance: {{ alert.percent | number:'1.0-1' }}%</p>
                <p>Total Records: {{ alert.total }}</p>
              </div>
            </div>
          </div>
          <div *ngIf="attendanceOverview?.lowAttendanceAlerts?.length === 0" class="empty-state">
            <p>No low attendance alerts.</p>
          </div>

          <div class="form-header" style="margin-top: 32px;">
            <h3>Student Attendance Reports</h3>
          </div>
          <div *ngIf="isLoadingAttendanceReports" class="loading">Loading student reports...</div>
          <div *ngIf="!isLoadingAttendanceReports && attendanceStudentReports.length === 0" class="empty-state">
            <p>No student attendance data.</p>
          </div>
          <div *ngIf="!isLoadingAttendanceReports && attendanceStudentReports.length > 0" class="attendance-summary-table">
            <div class="summary-table-header">
              <span>Student ID</span>
              <span>Present</span>
              <span>Total</span>
              <span>Attendance</span>
              </div>
            <div class="summary-table-row" *ngFor="let report of attendanceStudentReports">
              <span class="summary-name">{{ report.studentId }}</span>
              <span class="summary-present">{{ report.present }}</span>
              <span class="summary-total">{{ report.total }}</span>
              <span>
                <span class="summary-percent"
                      [style.color]="report.percent >= 75 ? 'var(--accent-green)' : '#f59e0b'">
                  {{ report.percent | number:'1.0-1' }}%
                </span>
              </span>
            </div>
          </div>

          <div class="form-header" style="margin-top: 32px;">
            <h3>Teacher Attendance Activity (Student Attendance Marking)</h3>
          </div>
          <div *ngIf="isLoadingAttendanceTeachers" class="loading">Loading teacher activity...</div>
          <div *ngIf="!isLoadingAttendanceTeachers && attendanceTeacherActivity.length === 0" class="empty-state">
            <p>No teacher attendance activity found.</p>
          </div>
          <div *ngIf="!isLoadingAttendanceTeachers && attendanceTeacherActivity.length > 0" class="attendance-summary-table">
            <div class="summary-table-header">
              <span>Teacher</span>
              <span>Sessions</span>
              <span>Marked</span>
              <span>Pending</span>
            </div>
            <div class="summary-table-row" *ngFor="let activity of attendanceTeacherActivity">
              <span class="summary-name">{{ getTeacherName(activity.teacherId) }}</span>
              <span class="summary-total">{{ activity.sessions }}</span>
              <span class="summary-present">{{ activity.markedEntries }}</span>
              <span class="summary-pending">{{ activity.pendingEntries }}</span>
            </div>
          </div>

          <!-- Teacher Attendance Section -->
          <div class="form-header" style="margin-top: 32px; border-top: 2px solid var(--border-gray); padding-top: 24px;">
            <h2 style="margin-bottom: 8px;">üë©‚Äçüè´ Teacher Attendance</h2>
            <p class="section-subtitle">Mark daily teacher attendance ‚Ä¢ View reports ‚Ä¢ Track leaves</p>
          </div>

          <!-- Teacher Attendance View Toggle -->
          <div class="attendance-view-toggle" style="margin-bottom: 24px;">
            <button class="toggle-btn" [class.active]="teacherAttendanceView === 'mark'" (click)="teacherAttendanceView = 'mark'">
              Mark Attendance
            </button>
            <button class="toggle-btn" [class.active]="teacherAttendanceView === 'dashboard'" (click)="teacherAttendanceView = 'dashboard'; loadTeacherAttendanceDashboard()">
              Dashboard
            </button>
            <button class="toggle-btn" [class.active]="teacherAttendanceView === 'reports'" (click)="teacherAttendanceView = 'reports'">
              Reports
            </button>
          </div>

          <!-- Mark Teacher Attendance View -->
          <div class="content-card" *ngIf="teacherAttendanceView === 'mark'">
            <div class="attendance-filters">
              <div class="filter-group">
                <label>Date:</label>
                <input type="date" class="form-input" [(ngModel)]="teacherAttendanceDate" (ngModelChange)="loadTeacherDailyAttendance()" />
              </div>
              <div class="filter-group">
                <button class="btn-primary" (click)="loadTeacherDailyAttendance()" [disabled]="isLoadingTeacherAttendance">
                  <span *ngIf="!isLoadingTeacherAttendance">Load Teachers</span>
                  <span *ngIf="isLoadingTeacherAttendance">Loading...</span>
                </button>
              </div>
            </div>

            <!-- Teacher Attendance Stats -->
            <div class="attendance-status-indicator" *ngIf="teacherAttendanceSession">
              <div class="status-item">
                <span class="status-label">Status:</span>
                <span class="status-badge" [class.completed]="teacherAttendanceSession.status === 'completed'" [class.open]="teacherAttendanceSession.status === 'open'">
                  {{ teacherAttendanceSession.status === 'completed' ? 'Marked' : 'Pending' }}
                </span>
              </div>
              <div class="status-item">
                <span class="status-label">Total Teachers:</span>
                <span class="status-value">{{ teacherAttendanceData?.totalTeachers || 0 }}</span>
              </div>
              <div class="status-item">
                <span class="status-label">Marked:</span>
                <span class="status-value">{{ teacherAttendanceData?.markedCount || 0 }}</span>
              </div>
              <div class="status-item">
                <span class="status-label">Pending:</span>
                <span class="status-value">{{ teacherAttendanceData?.pendingCount || 0 }}</span>
              </div>
            </div>

            <!-- Teacher List -->
            <div class="attendance-student-list" *ngIf="teacherAttendanceList.length > 0">
              <div class="bulk-actions">
                <button class="btn-secondary" (click)="markAllTeachersPresent()">Mark All Present</button>
                <button class="btn-secondary" (click)="resetTeacherAttendance()">Reset</button>
                <div class="attendance-summary">
                  <span>Present: <strong>{{ getTeacherPresentCount() }}</strong></span>
                  <span>Absent: <strong>{{ getTeacherAbsentCount() }}</strong></span>
                  <span>Leave: <strong>{{ getTeacherLeaveCount() }}</strong></span>
                  <span>Half-Day: <strong>{{ getTeacherHalfDayCount() }}</strong></span>
                </div>
              </div>

              <div class="attendance-item" *ngFor="let teacher of teacherAttendanceList">
                <div class="student-info">
                  <div class="student-name">{{ teacher.name }}</div>
                  <div class="student-roll">Employee ID: {{ teacher.employeeId || 'N/A' }}</div>
                </div>
                <div class="attendance-options">
                  <button class="attendance-btn present" 
                          [class.active]="teacher.status === 'present'" 
                          (click)="markTeacherAttendanceStatus(teacher, 'present')">
                    Present
                  </button>
                  <button class="attendance-btn absent" 
                          [class.active]="teacher.status === 'absent'" 
                          (click)="markTeacherAttendanceStatus(teacher, 'absent')">
                    Absent
                  </button>
                  <button class="attendance-btn leave" 
                          [class.active]="teacher.status === 'leave'" 
                          (click)="markTeacherAttendanceStatus(teacher, 'leave')">
                    Leave
                  </button>
                  <button class="attendance-btn half-day" 
                          [class.active]="teacher.status === 'half-day'" 
                          (click)="markTeacherAttendanceStatus(teacher, 'half-day')">
                    Half-Day
                  </button>
                </div>
              </div>

              <div class="attendance-actions">
                <button class="btn-primary" (click)="saveTeacherAttendance()" [disabled]="isSavingTeacherAttendance">
                  <span *ngIf="!isSavingTeacherAttendance">Save Teacher Attendance</span>
                  <span *ngIf="isSavingTeacherAttendance">Saving...</span>
                </button>
              </div>
            </div>

            <div class="empty-state" *ngIf="teacherAttendanceList.length === 0 && !isLoadingTeacherAttendance">
              <p>Select a date and click "Load Teachers" to mark teacher attendance</p>
            </div>
          </div>

          <!-- Teacher Attendance Dashboard -->
          <div class="content-card" *ngIf="teacherAttendanceView === 'dashboard'">
            <div class="overview-grid" *ngIf="teacherAttendanceDashboard">
              <div class="stat-card">
                <div class="stat-label">Total Teachers</div>
                <div class="stat-value">{{ teacherAttendanceDashboard.totalTeachers || 0 }}</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">Present Today</div>
                <div class="stat-value" style="color: var(--accent-green);">{{ teacherAttendanceDashboard.todayPresent || 0 }}</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">Absent Today</div>
                <div class="stat-value" style="color: #ef4444;">{{ teacherAttendanceDashboard.todayAbsent || 0 }}</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">On Leave Today</div>
                <div class="stat-value" style="color: #f59e0b;">{{ teacherAttendanceDashboard.todayLeave || 0 }}</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">Half-Day Today</div>
                <div class="stat-value" style="color: #3b82f6;">{{ teacherAttendanceDashboard.todayHalfDay || 0 }}</div>
              </div>
            </div>

            <div class="form-header" style="margin-top: 24px;">
              <h3>Teacher-wise Attendance %</h3>
            </div>
            <div *ngIf="teacherAttendanceDashboard?.teacherReports?.length" class="assignments-list">
              <div class="assignment-card" *ngFor="let report of teacherAttendanceDashboard.teacherReports">
              <div class="assignment-info">
                  <p><strong>{{ report.name }}</strong> ({{ report.employeeId }})</p>
                  <p>Attendance: <span [style.color]="report.percentage >= 75 ? 'var(--accent-green)' : '#f59e0b'">{{ report.percentage | number:'1.0-1' }}%</span></p>
                  <p>Present: {{ report.presentCount }} / {{ report.totalCount }}</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Teacher Attendance Reports -->
          <div class="content-card" *ngIf="teacherAttendanceView === 'reports'">
            <div class="history-filters">
              <div class="filter-group">
                <label>From Date:</label>
                <input type="date" class="form-input" [(ngModel)]="teacherReportFromDate" />
              </div>
              <div class="filter-group">
                <label>To Date:</label>
                <input type="date" class="form-input" [(ngModel)]="teacherReportToDate" />
              </div>
              <div class="filter-group">
                <button class="btn-primary" (click)="loadTeacherAttendanceReports()" [disabled]="isLoadingTeacherReports">
                  <span *ngIf="!isLoadingTeacherReports">Generate Report</span>
                  <span *ngIf="isLoadingTeacherReports">Loading...</span>
                </button>
              </div>
            </div>

            <div *ngIf="teacherAttendanceReports.length > 0" class="assignments-list">
              <div class="assignment-card" *ngFor="let report of teacherAttendanceReports">
                <div class="assignment-info">
                  <p><strong>{{ report.name }}</strong> ({{ report.employeeId }})</p>
                  <p>Present: {{ report.present }} ‚Ä¢ Absent: {{ report.absent }} ‚Ä¢ Leave: {{ report.leave }} ‚Ä¢ Half-Day: {{ report.halfDay }}</p>
                  <p>Total: {{ report.total }} ‚Ä¢ Percentage: <span [style.color]="report.percentage >= 75 ? 'var(--accent-green)' : '#f59e0b'">{{ report.percentage | number:'1.0-1' }}%</span></p>
                </div>
              </div>
            </div>

            <div class="empty-state" *ngIf="teacherAttendanceReports.length === 0 && !isLoadingTeacherReports">
              <p>Select date range and click "Generate Report"</p>
            </div>
          </div>

          <div class="form-header" style="margin-top: 16px;">
            <h3>Attendance Policy & Rules</h3>
          </div>
          <div *ngIf="isLoadingAttendancePolicy" class="loading">Loading policy...</div>
          <div *ngIf="attendancePolicy" class="form-row" style="margin: 0 0 16px;">
            <div class="form-group">
              <label>Minimum Attendance %</label>
              <input class="form-input" type="number" [(ngModel)]="attendancePolicy.minAttendancePercent" />
            </div>
            <div class="form-group">
              <label>Warning Threshold %</label>
              <input class="form-input" type="number" [(ngModel)]="attendancePolicy.warningThresholdPercent" />
            </div>
            <div class="form-group">
              <label>Detention Threshold %</label>
              <input class="form-input" type="number" [(ngModel)]="attendancePolicy.detentionThresholdPercent" />
            </div>
          </div>
          <div *ngIf="attendancePolicy" class="form-row" style="margin: 0 0 16px;">
            <div class="form-group">
              <label>Exam Eligibility %</label>
              <input class="form-input" type="number" [(ngModel)]="attendancePolicy.examEligibilityPercent" />
            </div>
            <div class="form-group">
              <label>Assignment Eligibility %</label>
              <input class="form-input" type="number" [(ngModel)]="attendancePolicy.assignmentEligibilityPercent" />
            </div>
            <div class="form-group">
              <label>Lock After Days</label>
              <input class="form-input" type="number" [(ngModel)]="attendancePolicy.lockAfterDays" />
            </div>
          </div>
          <div class="form-actions" style="margin-bottom: 16px;">
            <button class="btn-primary" (click)="saveAttendancePolicy()">Save Policy</button>
          </div>

          <div class="form-header" style="margin-top: 16px;">
            <h3>Attendance Corrections</h3>
          </div>
          <div *ngIf="isLoadingAttendanceCorrections" class="loading">Loading corrections...</div>
          <div *ngIf="!isLoadingAttendanceCorrections && attendanceCorrections.length === 0" class="empty-state">
            <p>No correction requests pending.</p>
          </div>
          <div *ngIf="!isLoadingAttendanceCorrections && attendanceCorrections.length > 0" class="assignments-list">
            <div class="assignment-card" *ngFor="let correction of attendanceCorrections">
              <div class="assignment-info">
                <p><strong>Entry ID:</strong> {{ correction.entryId }}</p>
                <p>Requested Status: {{ correction.requestedStatus }}</p>
                <p>Reason: {{ correction.reason || 'N/A' }}</p>
              </div>
              <div class="assignment-actions" style="display: flex; gap: 8px;">
                <button class="btn-secondary" (click)="updateAttendanceCorrection(correction, 'approved')">Approve</button>
                <button class="btn-delete" (click)="updateAttendanceCorrection(correction, 'rejected')">Reject</button>
              </div>
            </div>
          </div>

          <div class="form-header" style="margin-top: 16px;">
            <h3>Audit Logs</h3>
          </div>
          <div *ngIf="isLoadingAttendanceAudit" class="loading">Loading audit logs...</div>
          <div *ngIf="!isLoadingAttendanceAudit && attendanceAuditLogs.length === 0" class="empty-state">
            <p>No audit logs available.</p>
          </div>
          <div *ngIf="!isLoadingAttendanceAudit && attendanceAuditLogs.length > 0" class="assignments-list">
            <div class="assignment-card" *ngFor="let log of attendanceAuditLogs">
              <div class="assignment-info">
                <p><strong>{{ log.action }}</strong></p>
                <p>Session: {{ log.sessionId || 'N/A' }} ‚Ä¢ Entry: {{ log.entryId || 'N/A' }}</p>
                <p>Changed By: {{ log.changedByRole || 'N/A' }} ‚Ä¢ {{ log.changedAt || '' }}</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Notices Tab -->
        <div class="dashboard-section" *ngIf="activeTab === 'notices'">
          <div class="section-header">
            <div>
              <h2 class="section-title">Notices</h2>
              <p class="section-subtitle">Create, publish, and track official notices</p>
            </div>
          </div>

          <div class="overview-grid">
            <div class="stat-card">
              <div class="stat-label">Total</div>
              <div class="stat-value">{{ noticesOverview?.total || 0 }}</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Published</div>
              <div class="stat-value">{{ noticesOverview?.published || 0 }}</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Draft</div>
              <div class="stat-value">{{ noticesOverview?.draft || 0 }}</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Scheduled</div>
              <div class="stat-value">{{ noticesOverview?.scheduled || 0 }}</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Archived</div>
              <div class="stat-value">{{ noticesOverview?.archived || 0 }}</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Expired</div>
              <div class="stat-value">{{ noticesOverview?.expired || 0 }}</div>
            </div>
          </div>

          <div class="form-header">
            <h3>{{ isEditingNotice ? 'Edit Notice' : 'Create Notice' }}</h3>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Title *</label>
              <input class="form-input" [(ngModel)]="noticeForm.title" placeholder="Notice title" />
            </div>
            <div class="form-group">
              <label>Notice Type</label>
              <select class="form-input" [(ngModel)]="noticeForm.noticeType">
                <option *ngFor="let type of noticeTypes" [value]="type">{{ type }}</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea class="form-input" rows="3" [(ngModel)]="noticeForm.description" placeholder="Notice details"></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Target Audience</label>
              <select class="form-input" [(ngModel)]="noticeForm.targetAudience">
                <option *ngFor="let target of noticeTargets" [value]="target">{{ target }}</option>
              </select>
            </div>
            <div class="form-group">
              <label>Status</label>
              <select class="form-input" [(ngModel)]="noticeForm.status">
                <option value="draft">draft</option>
                <option value="published">published</option>
                <option value="scheduled">scheduled</option>
                <option value="archived">archived</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Publish At</label>
              <input type="datetime-local" class="form-input" [(ngModel)]="noticeForm.publishAt" />
            </div>
            <div class="form-group">
              <label>Expires At</label>
              <input type="datetime-local" class="form-input" [(ngModel)]="noticeForm.expiresAt" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Course</label>
              <select class="form-input" [(ngModel)]="noticeForm.courseId" (change)="onNoticeFormCourseChange()">
                <option value="">All</option>
                <option *ngFor="let course of courses" [value]="course.id">{{ course.name }}</option>
              </select>
            </div>
            <div class="form-group">
              <label>Class</label>
              <select class="form-input" [(ngModel)]="noticeForm.classId" (change)="onNoticeFormClassChange()">
                <option value="">All</option>
                <option *ngFor="let classItem of noticeFormClasses" [value]="classItem.id">{{ classItem.name }}</option>
              </select>
            </div>
            <div class="form-group">
              <label>Section</label>
              <select class="form-input" [(ngModel)]="noticeForm.sectionId">
                <option value="">All</option>
                <option *ngFor="let section of noticeFormSections" [value]="section.id">{{ section.name }}</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Visible to Students</label>
              <select class="form-input" [(ngModel)]="noticeForm.visibleToStudents">
                <option [ngValue]="true">Yes</option>
                <option [ngValue]="false">No</option>
              </select>
            </div>
            <div class="form-group">
              <label>Visible to Teachers</label>
              <select class="form-input" [(ngModel)]="noticeForm.visibleToTeachers">
                <option [ngValue]="true">Yes</option>
                <option [ngValue]="false">No</option>
              </select>
            </div>
            <div class="form-group">
              <label>Visible to Parents</label>
              <select class="form-input" [(ngModel)]="noticeForm.visibleToParents">
                <option [ngValue]="true">Yes</option>
                <option [ngValue]="false">No</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Email</label>
              <select class="form-input" [(ngModel)]="noticeForm.sendEmail">
                <option [ngValue]="false">No</option>
                <option [ngValue]="true">Yes</option>
              </select>
            </div>
            <div class="form-group">
              <label>SMS</label>
              <select class="form-input" [(ngModel)]="noticeForm.sendSms">
                <option [ngValue]="false">No</option>
                <option [ngValue]="true">Yes</option>
              </select>
            </div>
            <div class="form-group">
              <label>WhatsApp</label>
              <select class="form-input" [(ngModel)]="noticeForm.sendWhatsapp">
                <option [ngValue]="false">No</option>
                <option [ngValue]="true">Yes</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Attachment (PDF/Image)</label>
              <input type="file" class="form-input" (change)="onNoticeAttachmentSelect($event)" accept=".pdf,image/*" />
              <small class="form-hint" *ngIf="noticeForm.attachmentName">Selected: {{ noticeForm.attachmentName }}</small>
            </div>
          </div>
          <div class="form-actions" style="margin-bottom: 16px;">
            <button class="btn-primary" (click)="saveNotice()">{{ isEditingNotice ? 'Update Notice' : 'Save Notice' }}</button>
            <button class="btn-secondary" (click)="resetNoticeForm()">Reset</button>
          </div>

          <div class="form-header" style="margin-top: 16px;">
            <h3>Notice Filters</h3>
            <button class="btn-secondary" type="button" (click)="showNoticeFilters = !showNoticeFilters">
              {{ showNoticeFilters ? 'Hide Filters' : 'Filter' }}
            </button>
          </div>
          <div *ngIf="showNoticeFilters">
            <div class="form-row" style="margin: 0 0 16px;">
              <div class="form-group">
                <label>Course</label>
                <select class="form-input" [(ngModel)]="noticeFilters.courseId" (change)="onNoticeCourseChange()">
                  <option value="">All</option>
                  <option *ngFor="let course of courses" [value]="course.id">{{ course.name }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Class</label>
                <select class="form-input" [(ngModel)]="noticeFilters.classId" (change)="onNoticeClassChange()">
                  <option value="">All</option>
                  <option *ngFor="let classItem of noticeFilterClasses" [value]="classItem.id">{{ classItem.name }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Section</label>
                <select class="form-input" [(ngModel)]="noticeFilters.sectionId">
                  <option value="">All</option>
                  <option *ngFor="let section of noticeFilterSections" [value]="section.id">{{ section.name }}</option>
                </select>
              </div>
            </div>
            <div class="form-row" style="margin: 0 0 16px;">
              <div class="form-group">
                <label>Type</label>
                <select class="form-input" [(ngModel)]="noticeFilters.noticeType">
                  <option value="">All</option>
                  <option *ngFor="let type of noticeTypes" [value]="type">{{ type }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Audience</label>
                <select class="form-input" [(ngModel)]="noticeFilters.targetAudience">
                  <option value="">All</option>
                  <option *ngFor="let target of noticeTargets" [value]="target">{{ target }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Status</label>
                <select class="form-input" [(ngModel)]="noticeFilters.status">
                  <option value="">All</option>
                  <option value="draft">draft</option>
                  <option value="published">published</option>
                  <option value="scheduled">scheduled</option>
                  <option value="archived">archived</option>
                </select>
              </div>
            </div>
            <div class="form-row" style="margin: 0 0 16px;">
              <div class="form-group">
                <label>From Date</label>
                <input type="date" class="form-input" [(ngModel)]="noticeFilters.fromDate" />
              </div>
              <div class="form-group">
                <label>To Date</label>
                <input type="date" class="form-input" [(ngModel)]="noticeFilters.toDate" />
              </div>
            </div>
            <div class="form-actions" style="margin-bottom: 16px;">
              <button class="btn-primary" (click)="applyNoticeFilters()">Apply Filters</button>
              <button class="btn-secondary" (click)="resetNoticeFilters()">Reset</button>
            </div>
          </div>

          <div *ngIf="isLoadingNotices" class="loading">Loading notices...</div>
          <div *ngIf="!isLoadingNotices && adminNotices.length === 0" class="empty-state">
            <p>No notices available.</p>
          </div>
          <div *ngIf="!isLoadingNotices && adminNotices.length > 0" class="notices-table">
            <div class="notices-table-header">
              <span>Title</span>
              <span>Type</span>
              <span>Status</span>
              <span>Publish Date</span>
              <span>Read</span>
              <span>Actions</span>
              </div>
            <div class="notices-table-row" *ngFor="let notice of adminNotices">
              <span class="notice-title">
                <strong>{{ notice.title }}</strong>
                <div class="notice-meta">
                  <span *ngIf="notice.targetAudience" style="color: var(--text-gray); font-size: 12px;">
                    {{ notice.targetAudience }}
                  </span>
                  <a *ngIf="notice.attachmentData" 
                     [href]="notice.attachmentData" 
                     [download]="notice.attachmentName"
                     (click)="$event.stopPropagation()"
                     style="color: var(--accent-green); font-size: 12px; margin-left: 8px; text-decoration: none; font-weight: 700;">
                    üìé {{ notice.attachmentName }}
                  </a>
                  <span *ngIf="!notice.attachmentData && notice.attachmentName" style="color: var(--text-gray); font-size: 12px; margin-left: 8px;">
                    üìé {{ notice.attachmentName }}
                  </span>
                </div>
              </span>
              <span>{{ notice.noticeType || 'General' }}</span>
              <span>
                <span class="status-badge" 
                      [class.status-active]="notice.status === 'published'"
                      [class.status-inactive]="notice.status === 'draft' || notice.status === 'archived'">
                  {{ notice.status }}<span *ngIf="notice.expired"> (expired)</span>
                </span>
              </span>
              <span style="font-size: 13px;">{{ formatNoticeDate(notice.publishAt) || 'N/A' }}</span>
              <span style="font-size: 13px;">
                {{ notice.readCount || 0 }}/{{ notice.totalAudience || 0 }} 
                <span style="color: var(--text-gray); font-size: 11px;">
                  ({{ notice.reachPercent | number:'1.0-1' }}%)
                </span>
              </span>
              <span class="notice-actions">
                <button class="btn-edit" (click)="editNotice(notice)">Edit</button>
                <button class="btn-secondary" 
                        (click)="updateNoticeStatus(notice, 'published')"
                        *ngIf="notice.status !== 'published'">Publish</button>
                <button class="btn-secondary" 
                        (click)="updateNoticeStatus(notice, notice.status === 'archived' ? 'draft' : 'archived')">
                  {{ notice.status === 'archived' ? 'Unarchive' : 'Archive' }}
                </button>
                <button class="btn-delete" (click)="deleteNotice(notice)">Delete</button>
              </span>
            </div>
          </div>

          <div class="form-header" style="margin-top: 16px;">
            <h3>Notice Audit Logs</h3>
          </div>
          <div *ngIf="isLoadingNoticeAudit" class="loading">Loading audit logs...</div>
          <div *ngIf="!isLoadingNoticeAudit && noticeAuditLogs.length === 0" class="empty-state">
            <p>No audit logs available.</p>
          </div>
          <div *ngIf="!isLoadingNoticeAudit && noticeAuditLogs.length > 0" class="notices-table">
            <div class="notices-table-header">
              <span>Action</span>
              <span>Notice ID</span>
              <span>Changed By</span>
              <span>Changed At</span>
              <span>Old Value</span>
              <span>New Value</span>
              <span>Actions</span>
              </div>
            <div class="notices-table-row" *ngFor="let log of noticeAuditLogs">
              <span>
                <span class="status-badge" 
                      [class.status-active]="log.action === 'create'"
                      [class.status-inactive]="log.action === 'delete'"
                      style="background: rgba(59, 130, 246, 0.12); border: 1px solid rgba(59, 130, 246, 0.25); color: #3b82f6;"
                      *ngIf="log.action === 'status_update' || log.action === 'update'">
                  {{ log.action }}
                </span>
                <span class="status-badge status-active" *ngIf="log.action === 'create'">
                  {{ log.action }}
                </span>
                <span class="status-badge status-inactive" *ngIf="log.action === 'delete'">
                  {{ log.action }}
                </span>
              </span>
              <span>{{ log.noticeId || 'N/A' }}</span>
              <span>{{ log.changedByRole || 'N/A' }}</span>
              <span style="font-size: 13px;">{{ formatAuditDate(log.changedAt) || 'N/A' }}</span>
              <span style="font-size: 12px; color: var(--text-gray); max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                {{ log.oldValue || 'N/A' }}
              </span>
              <span style="font-size: 12px; color: var(--text-gray); max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                {{ log.newValue || 'N/A' }}
              </span>
              <span class="notice-actions">
                <button class="btn-delete" (click)="deleteAuditLog(log)">Delete</button>
              </span>
            </div>
          </div>
        </div>

        <!-- Teacher Announcements Tab -->
        <div class="dashboard-section" *ngIf="activeTab === 'teacher-announcements'">
          <div class="section-header">
            <div>
              <h2 class="section-title">üïµÔ∏è Teacher Announcements</h2>
              <p class="section-subtitle">Monitor and manage teacher-created announcements</p>
            </div>
          </div>

          <!-- Filters -->
          <div class="form-header" style="margin: 16px 0 12px;">
            <h3>Filters</h3>
            <button class="btn-secondary" type="button" (click)="showTeacherAnnouncementFilters = !showTeacherAnnouncementFilters">
              {{ showTeacherAnnouncementFilters ? 'Hide Filters' : 'Filter' }}
            </button>
          </div>
          <div *ngIf="showTeacherAnnouncementFilters" class="form-row" style="margin: 0 0 16px;">
            <div class="form-group">
              <label>Status</label>
              <select class="form-input" [(ngModel)]="teacherAnnouncementFilters.status">
                <option value="">All</option>
                <option value="draft">Draft</option>
                <option value="published">Published</option>
                <option value="scheduled">Scheduled</option>
              </select>
            </div>
            <div class="form-group">
              <label>Type</label>
              <select class="form-input" [(ngModel)]="teacherAnnouncementFilters.type">
                <option value="">All</option>
                <option value="Assignment reminder">Assignment reminder</option>
                <option value="Exam reminder">Exam reminder</option>
                <option value="Extra class">Extra class</option>
                <option value="Instructions">Instructions</option>
              </select>
            </div>
            <div class="form-group">
              <label>Show Hidden</label>
              <select class="form-input" [(ngModel)]="teacherAnnouncementFilters.includeHidden">
                <option [value]="false">No</option>
                <option [value]="true">Yes</option>
              </select>
            </div>
            <div class="form-actions" style="margin-top: 24px;">
              <button class="btn-primary" (click)="loadTeacherAnnouncements()">Apply Filters</button>
              <button class="btn-secondary" (click)="resetTeacherAnnouncementFilters()">Reset</button>
            </div>
          </div>

          <!-- Announcements List -->
          <div *ngIf="isLoadingTeacherAnnouncements" class="loading">Loading announcements...</div>
          <div *ngIf="!isLoadingTeacherAnnouncements && teacherAnnouncements.length === 0" class="empty-state">
            <p>No teacher announcements found.</p>
          </div>
          <div *ngIf="!isLoadingTeacherAnnouncements && teacherAnnouncements.length > 0" class="teacher-announcements-table">
            <div class="teacher-announcements-header">
              <span>Title</span>
              <span>Subject</span>
              <span>Type</span>
              <span>Status</span>
              <span>Publish Date</span>
              <span>Actions</span>
            </div>
            <div class="teacher-announcements-row" *ngFor="let announcement of teacherAnnouncements">
              <span class="announcement-title-cell">
                <div class="title-main">
                  <strong>{{ announcement.title }}</strong>
                  <span *ngIf="announcement.teacherName" class="teacher-name-badge">{{ announcement.teacherName }}</span>
                </div>
                <div class="title-meta" *ngIf="announcement.attachmentName || announcement.isHidden || announcement.adminRemark">
                  <a *ngIf="announcement.attachmentName && announcement.attachmentData" 
                     [href]="announcement.attachmentData" 
                     [download]="announcement.attachmentName"
                     (click)="$event.stopPropagation()"
                     class="attachment-link">
                    üìé {{ announcement.attachmentName }}
                  </a>
                  <span *ngIf="announcement.isHidden" class="meta-badge hidden-badge">üîí Hidden</span>
                  <span *ngIf="announcement.adminRemark" class="meta-badge remark-badge">üìù Has Remark</span>
                </div>
              </span>
              <span class="announcement-subject-cell">{{ getSubjectNameById(announcement.subjectId) || 'N/A' }}</span>
              <span class="announcement-type-cell">{{ announcement.announcementType || 'N/A' }}</span>
              <span class="announcement-status-cell">
                <span class="status-badge" 
                      [class.status-active]="announcement.status === 'published'"
                      [class.status-inactive]="announcement.status === 'draft'">
                  {{ announcement.status || 'draft' }}
                </span>
              </span>
              <span class="announcement-date-cell">{{ formatAnnouncementDate(announcement.publishAt || announcement.createdAt) || 'N/A' }}</span>
              <span class="announcement-actions-cell">
                <button class="btn-view" (click)="viewTeacherAnnouncement(announcement)">View</button>
                <button class="btn-secondary" 
                        (click)="toggleHideAnnouncement(announcement)"
                        [style.background]="announcement.isHidden ? '#10b981' : '#ef4444'"
                        [style.border-color]="announcement.isHidden ? '#10b981' : '#ef4444'">
                  {{ announcement.isHidden ? 'Show' : 'Hide' }}
                </button>
                <button class="btn-edit" (click)="addAdminRemark(announcement)">Remark</button>
              </span>
            </div>
          </div>
        </div>

        <!-- Fees Tab -->
        <app-admin-fees
          *ngIf="activeTab === 'fees' && entity"
          [entity]="entity"
          [courses]="courses"
          [students]="students"
          (showSnackbar)="showSnackbarMessage($event.message, $event.type)"
        ></app-admin-fees>

        <!-- Exams Tab -->
        <app-admin-exams
          *ngIf="activeTab === 'exam-attempts' && entity"
          [entity]="entity"
          [courses]="courses"
          [teachers]="teachers"
          (showSnackbar)="showSnackbarMessage($event.message, $event.type)"
        ></app-admin-exams>

        <!-- Questions Tab -->
        <app-admin-questions
          *ngIf="activeTab === 'questions' && entity"
          [entity]="entity"
          [courses]="courses"
          [teachers]="teachers"
          (showSnackbar)="showSnackbarMessage($event.message, $event.type)"
        ></app-admin-questions>

        <!-- Reports Tab -->
        <app-admin-reports
          *ngIf="activeTab === 'reports' && entity"
          [entity]="entity"
          [courses]="courses"
          [teachers]="teachers"
          (showSnackbar)="showSnackbarMessage($event.message, $event.type)"
        ></app-admin-reports>

        <!-- Settings Tab -->
        <div class="settings-section" *ngIf="activeTab === 'settings' && entity">
          <div class="settings-header">
            <div>
              <h2 class="settings-title">Entity Settings</h2>
              <p class="settings-subtitle">Update entity information and configuration</p>
            </div>
            <button class="edit-icon-btn" (click)="toggleEditMode()" *ngIf="!isEditing">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M18.5 2.5C18.8978 2.10218 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10218 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10218 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>

          <div class="settings-content">
            <!-- Left Column: General Settings -->
            <div class="settings-column">
              <div class="settings-card">
                <div class="card-header">
                  <h3 class="card-title">General Settings</h3>
                  <p class="card-subtitle">Basic entity information and configuration</p>
                </div>
                <div class="card-body">
                  <div class="form-group">
                    <label>Institution Name *</label>
                    <input
                      type="text"
                      class="form-input"
                      [(ngModel)]="editForm.name"
                      [disabled]="!isEditing"
                      placeholder="Enter institution name"
                    />
                  </div>
                  <div class="form-group">
                    <label>Type *</label>
                    <select class="form-input" [(ngModel)]="editForm.type" [disabled]="!isEditing">
                      <option value="">Select type</option>
                      <option value="SCHOOL">School</option>
                      <option value="COLLEGE">College</option>
                      <option value="UNIVERSITY">University</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label>Address *</label>
                    <input
                      type="text"
                      class="form-input"
                      [(ngModel)]="editForm.address"
                      [disabled]="!isEditing"
                      placeholder="City, State/Country" 
                    />
                  </div>
                  <div class="form-group">
                    <label>College Logo</label>
                    <div class="logo-upload-section">
                      <div class="logo-placeholder" (click)="isEditing && triggerFileUpload()">
                        <img *ngIf="logoPreview || entity.logoUrl" [src]="logoPreview || entity.logoUrl || ''" alt="Logo preview" class="logo-preview" />
                        <span *ngIf="!logoPreview && !entity.logoUrl" class="logo-placeholder-text">No logo</span>
                      </div>
                      <button 
                        type="button" 
                        class="logo-upload-btn" 
                        (click)="isEditing && triggerFileUpload()" 
                        *ngIf="isEditing"
                        aria-label="Upload logo"
                      >
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <path d="M7 10L12 5L17 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <path d="M12 5V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </button>
                      <input
                        type="file"
                        #fileInput
                        (change)="onLogoFileSelect($event)"
                        accept="image/*"
                        style="display: none;"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Right Column: Contact Information -->
            <div class="settings-column">
              <div class="settings-card">
                <div class="card-header">
                  <h3 class="card-title">Contact Information</h3>
                  <p class="card-subtitle">Contact details and communication preferences</p>
                </div>
                <div class="card-body">
                  <div class="form-group">
                    <label>Contact Email</label>
                    <input 
                      type="email" 
                      class="form-input" 
                      [(ngModel)]="editForm.email" 
                      [disabled]="!isEditing"
                      placeholder="contact@institution.com" 
                    />
                  </div>
                  <div class="form-group">
                    <label>Contact Phone</label>
                    <input 
                      type="tel" 
                      class="form-input" 
                      [(ngModel)]="editForm.phone" 
                      [disabled]="!isEditing"
                      placeholder="+1 234 567 8900" 
                    />
                  </div>
                  <div class="form-group">
                    <label>Description</label>
                    <textarea 
                      class="form-input textarea" 
                      [(ngModel)]="editForm.description" 
                      [disabled]="!isEditing"
                      placeholder="Brief description of the institution"
                    ></textarea>
                  </div>
                  <div class="form-group">
                    <label>Primary Color</label>
                    <input 
                      type="color" 
                      class="form-input color-input" 
                      [(ngModel)]="editForm.primaryColor" 
                      [disabled]="!isEditing"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Save/Cancel Buttons -->
          <div class="settings-actions" *ngIf="isEditing">
            <button class="btn-secondary" (click)="cancelEdit()">Cancel</button>
            <button class="btn-primary" (click)="saveChanges()">Save Changes</button>
          </div>
        </div>
      </main>

      <!-- Teacher Announcement View Modal -->
      <div class="modal-overlay" *ngIf="showTeacherAnnouncementModal" (click)="closeTeacherAnnouncementModal()">
        <div class="modal-content student-modal" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>Announcement Details</h2>
            <button class="close-btn" (click)="closeTeacherAnnouncementModal()">&times;</button>
          </div>
          <div class="modal-body" *ngIf="selectedTeacherAnnouncement">
            <div class="student-details-grid">
              <div class="detail-item">
                <span class="detail-label">Title</span>
                <span class="detail-value">{{ selectedTeacherAnnouncement.title }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Teacher</span>
                <span class="detail-value">{{ selectedTeacherAnnouncement.teacherName || 'Unknown' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Subject</span>
                <span class="detail-value">{{ getSubjectNameById(selectedTeacherAnnouncement.subjectId) || 'N/A' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Type</span>
                <span class="detail-value">{{ selectedTeacherAnnouncement.announcementType || 'N/A' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Status</span>
                <span class="detail-value">
                  <span class="status-badge" 
                        [class.status-active]="selectedTeacherAnnouncement.status === 'published'"
                        [class.status-inactive]="selectedTeacherAnnouncement.status === 'draft'">
                    {{ selectedTeacherAnnouncement.status || 'draft' }}
                  </span>
                </span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Publish Date</span>
                <span class="detail-value">{{ formatAnnouncementDate(selectedTeacherAnnouncement.publishAt || selectedTeacherAnnouncement.createdAt) || 'N/A' }}</span>
              </div>
              <div class="detail-item" *ngIf="selectedTeacherAnnouncement.isHidden">
                <span class="detail-label">Visibility</span>
                <span class="detail-value" style="color: #ef4444; font-weight: 700;">üîí Hidden</span>
              </div>
              <div class="detail-item full-width" *ngIf="selectedTeacherAnnouncement.adminRemark">
                <span class="detail-label">Admin Remark</span>
                <span class="detail-value">{{ selectedTeacherAnnouncement.adminRemark }}</span>
              </div>
              <div class="detail-item full-width">
                <span class="detail-label">Description</span>
                <span class="detail-value">{{ selectedTeacherAnnouncement.description || 'N/A' }}</span>
              </div>
              <div class="detail-item full-width" *ngIf="selectedTeacherAnnouncement.attachmentName || selectedTeacherAnnouncement.attachmentData">
                <span class="detail-label">Attachment</span>
                <span class="detail-value">
                  <button class="btn-secondary" (click)="downloadTeacherAnnouncementAttachment(selectedTeacherAnnouncement)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15M7 10L12 15M12 15L17 10M12 15V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Download {{ selectedTeacherAnnouncement.attachmentName || 'Attachment' }}
                  </button>
                </span>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn-secondary" (click)="closeTeacherAnnouncementModal()">Close</button>
          </div>
        </div>
      </div>

      <!-- Admin Remark Modal -->
      <div class="modal-overlay" *ngIf="showAdminRemarkModal" (click)="closeAdminRemarkModal()">
        <div class="modal-content student-modal" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>Add Internal Remark</h2>
            <button class="close-btn" (click)="closeAdminRemarkModal()">&times;</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label>Internal Remark (Optional)</label>
              <textarea class="form-input" rows="4" [(ngModel)]="adminRemarkForm.remark" placeholder="Enter internal remark for this announcement..."></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn-secondary" (click)="closeAdminRemarkModal()">Cancel</button>
            <button class="btn-primary" (click)="saveAdminRemark()">Save Remark</button>
          </div>
        </div>
      </div>

      <!-- Approval/Rejection Modal -->
      <div class="modal-overlay" *ngIf="showActionModal" (click)="closeActionModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>{{ actionModalTitle }}</h2>
            <button class="close-btn" (click)="closeActionModal()">√ó</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label>Remark (Optional)</label>
              <textarea class="form-input" [(ngModel)]="actionRemark" rows="4" placeholder="Enter any remarks..."></textarea>
            </div>
            <div *ngIf="currentAction === 'approve' && admissionMainTab === 'student'">
              <div class="form-group">
                <label>Course *</label>
                <select class="form-input" [(ngModel)]="actionModalCourseId" (change)="onActionModalCourseChange()">
                  <option [value]="null">Select a course</option>
                  <option *ngFor="let course of courses" [value]="course.id">{{ course.name }}</option>
                </select>
              </div>
              <div class="form-group" *ngIf="actionModalCourseId">
                <label>Class / Semester *</label>
                <select class="form-input" [(ngModel)]="actionModalClassId" (ngModelChange)="onActionModalClassIdChange($event)" style="appearance: auto; -webkit-appearance: menulist; -moz-appearance: menulist;" [attr.data-class-id]="actionModalClassId">
                  <option [value]="null">Select a class/semester</option>
                  <option *ngFor="let classItem of actionModalClasses" [value]="classItem.id">{{ classItem.name }}</option>
                </select>
                <div *ngIf="actionModalClasses.length === 0 && actionModalCourseId" style="color: #ef4444; font-size: 12px; margin-top: 4px;">
                  ‚ö†Ô∏è No classes/semesters found for this course. Please create classes first.
                </div>
                <div *ngIf="actionModalClasses.length > 0" style="color: #10b981; font-size: 12px; margin-top: 4px;">
                  ‚úì {{ actionModalClasses.length }} class(es) available
                </div>
              </div>
              <div class="form-group" *ngIf="actionModalClassId">
                <label>Class Section *</label>
                <select class="form-input" [(ngModel)]="actionModalSectionId" (change)="onActionModalSectionChange()" style="appearance: auto; -webkit-appearance: menulist; -moz-appearance: menulist;">
                  <option [value]="null" disabled selected>-- Select Section (A, B, C, etc.) --</option>
                  <option *ngFor="let section of actionModalSections" [value]="section.id">
                    {{ section.name }}
                    <span *ngIf="section.capacity"> ({{ getSectionStudentCountForAction(section.id!) || 0 }}/{{ section.capacity }}</span>
                    <span *ngIf="section.capacity && getRemainingCapacityForAction(section) >= 0">, Remaining: {{ getRemainingCapacityForAction(section) }})</span>
                    <span *ngIf="section.capacity && getRemainingCapacityForAction(section) < 0">, FULL)</span>
                    <span *ngIf="!section.capacity"> (Unlimited)</span>
                  </option>
                </select>
                <div *ngIf="actionModalSections.length === 0 && actionModalClassId" style="color: #ef4444; font-size: 12px; margin-top: 4px;">
                  ‚ö†Ô∏è No sections found for this class. Please create sections first in "My Subjects" ‚Üí "Sections" tab.
                  <br><small style="color: var(--text-gray);">Debug: actionModalClassId={{ actionModalClassId }}, sections count={{ actionModalSections.length }}</small>
                </div>
                <div *ngIf="actionModalSections.length > 0" style="color: #10b981; font-size: 12px; margin-top: 4px;">
                  ‚úì {{ actionModalSections.length }} section(s) available: {{ getActionModalSectionsNames() }}
                </div>
              </div>
              <div class="form-group" *ngIf="actionModalSectionId">
                <label>Roll Number *</label>
                <input type="text" class="form-input" [(ngModel)]="rollNumber" [readonly]="true" placeholder="Auto-generated roll number" />
                <small class="form-hint" *ngIf="rollNumber" style="color: #10b981; font-size: 12px; margin-top: 4px; display: block;">
                  ‚úì Roll number generated: <strong>{{ rollNumber }}</strong>
                </small>
                <small class="form-hint" *ngIf="!rollNumber && actionModalSectionId" style="color: #f59e0b; font-size: 12px; margin-top: 4px; display: block;">
                  ‚è≥ Generating roll number...
                </small>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn-secondary" (click)="closeActionModal()">Cancel</button>
            <button class="btn-primary" (click)="confirmAdmissionAction()">Confirm</button>
          </div>
        </div>
      </div>

      <!-- Section Students Modal -->
      <div class="modal-overlay" *ngIf="showSectionStudentsModal" (click)="closeSectionStudentsModal()">
        <div class="modal-content student-modal" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>Students in Section {{ selectedSectionForView?.name }}</h2>
            <button class="close-btn" (click)="closeSectionStudentsModal()">&times;</button>
          </div>
          <div class="modal-body">
            <div *ngIf="selectedSectionForView" style="margin-bottom: 16px; padding: 12px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.25); border-radius: 8px;">
              <div style="display: flex; gap: 24px; flex-wrap: wrap;">
                <div>
                  <span style="color: var(--text-gray); font-size: 12px;">Capacity:</span>
                  <span style="font-weight: 700; margin-left: 4px;">{{ selectedSectionForView.capacity || 'Unlimited' }} students</span>
                </div>
                <div>
                  <span style="color: var(--text-gray); font-size: 12px;">Current:</span>
                  <span style="font-weight: 700; margin-left: 4px;">{{ sectionStudents.length }} students</span>
                </div>
                <div *ngIf="selectedSectionForView.capacity">
                  <span style="color: var(--text-gray); font-size: 12px;">Remaining:</span>
                  <span style="font-weight: 700; margin-left: 4px; color: {{ getRemainingCapacity(selectedSectionForView) >= 0 ? 'var(--accent-green)' : '#ef4444' }}">
                    {{ getRemainingCapacity(selectedSectionForView) }} students
                  </span>
                </div>
              </div>
            </div>
            <div style="margin-bottom: 16px; padding: 12px; background: rgba(255,255,255,0.02); border: 1px solid var(--border-gray); border-radius: 8px;">
              <div style="color: var(--text-gray); font-size: 12px; margin-bottom: 6px;">Assigned Teachers</div>
              <div *ngIf="isLoadingSectionTeachers" class="loading">Loading teachers...</div>
              <div *ngIf="!isLoadingSectionTeachers && sectionTeacherMappings.length === 0" style="color: var(--text-gray); font-size: 13px;">
                No teachers assigned to this section.
              </div>
              <div *ngIf="!isLoadingSectionTeachers && sectionTeacherMappings.length > 0" style="display: flex; flex-direction: column; gap: 6px;">
                <div *ngFor="let mapping of sectionTeacherMappings" style="display: flex; justify-content: space-between; gap: 12px;">
                  <span>{{ getTeacherName(mapping.teacherId) }}</span>
                  <span style="color: var(--text-gray); font-size: 13px;">{{ getSubjectName(mapping.subjectId) }}</span>
                </div>
              </div>
            </div>
            <div *ngIf="isLoadingSectionStudents" class="loading">Loading students...</div>
            <div *ngIf="!isLoadingSectionStudents && sectionStudents.length === 0" class="empty-state">
              <p>No students enrolled in this section yet.</p>
            </div>
            <div *ngIf="!isLoadingSectionStudents && sectionStudents.length > 0" class="students-list">
              <div class="student-item" *ngFor="let student of sectionStudents" style="padding: 12px; background: rgba(255,255,255,0.02); border: 1px solid var(--border-gray); border-radius: 8px; margin-bottom: 8px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <div>
                    <div style="font-weight: 700; margin-bottom: 4px;">{{ student.firstName }} {{ student.lastName }}</div>
                    <div style="color: var(--text-gray); font-size: 13px;">
                      Roll: {{ student.rollNumber || 'N/A' }} ‚Ä¢ Email: {{ student.email || 'N/A' }}
                    </div>
                  </div>
                  <span class="status-badge status-active" *ngIf="student.studentStatus === 'active'">Active</span>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn-secondary" (click)="closeSectionStudentsModal()">Close</button>
          </div>
        </div>
      </div>

      <!-- Subject Students Modal -->
      <div class="modal-overlay" *ngIf="showSubjectStudentsModal" (click)="closeSubjectStudentsModal()">
        <div class="modal-content student-modal" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>Students for {{ selectedSubjectForView?.name }}</h2>
            <button class="close-btn" (click)="closeSubjectStudentsModal()">&times;</button>
          </div>
          <div class="modal-body">
            <div *ngIf="selectedSubjectForView" style="margin-bottom: 16px; padding: 12px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.25); border-radius: 8px;">
              <div style="display: flex; gap: 24px; flex-wrap: wrap;">
                <div>
                  <span style="color: var(--text-gray); font-size: 12px;">Class:</span>
                  <span style="font-weight: 700; margin-left: 4px;">{{ getClassName(selectedSubjectForView.classId) }}</span>
                </div>
                <div>
                  <span style="color: var(--text-gray); font-size: 12px;">Sections:</span>
                  <span style="font-weight: 700; margin-left: 4px;">{{ getSectionNamesForClass(selectedSubjectForView.classId) }}</span>
                </div>
                <div>
                  <span style="color: var(--text-gray); font-size: 12px;">Total Students:</span>
                  <span style="font-weight: 700; margin-left: 4px;">{{ subjectStudents.length }}</span>
                </div>
              </div>
            </div>
            <div style="margin-bottom: 16px; padding: 12px; background: rgba(255,255,255,0.02); border: 1px solid var(--border-gray); border-radius: 8px;">
              <div style="color: var(--text-gray); font-size: 12px; margin-bottom: 6px;">Assigned Teachers</div>
              <div *ngIf="isLoadingSubjectTeachers" class="loading">Loading teachers...</div>
              <div *ngIf="!isLoadingSubjectTeachers && subjectTeacherMappingsForSubject.length === 0" style="color: var(--text-gray); font-size: 13px;">
                No teachers assigned to this subject.
              </div>
              <div *ngIf="!isLoadingSubjectTeachers && subjectTeacherMappingsForSubject.length > 0" style="display: flex; flex-direction: column; gap: 6px;">
                <div *ngFor="let mapping of subjectTeacherMappingsForSubject" style="display: flex; justify-content: space-between; gap: 12px;">
                  <span>{{ getTeacherName(mapping.teacherId) }}</span>
                  <span style="color: var(--text-gray); font-size: 13px;">
                    {{ mapping.sectionId ? getSectionName(mapping.sectionId) : 'All Sections' }}
                  </span>
                </div>
              </div>
            </div>
            <div *ngIf="isLoadingSubjectStudents" class="loading">Loading students...</div>
            <div *ngIf="!isLoadingSubjectStudents && subjectStudents.length === 0" class="empty-state">
              <p>No students enrolled for this class yet.</p>
            </div>
            <div *ngIf="!isLoadingSubjectStudents && subjectStudents.length > 0" class="students-list">
              <div class="student-item" *ngFor="let student of subjectStudents" style="padding: 12px; background: rgba(255,255,255,0.02); border: 1px solid var(--border-gray); border-radius: 8px; margin-bottom: 8px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <div>
                    <div style="font-weight: 700; margin-bottom: 4px;">{{ student.firstName }} {{ student.lastName }}</div>
                    <div style="color: var(--text-gray); font-size: 13px;">
                      Roll: {{ student.rollNumber || 'N/A' }} ‚Ä¢ Email: {{ student.email || 'N/A' }}
                    </div>
                  </div>
                  <span class="status-badge status-active" *ngIf="student.studentStatus === 'active'">Active</span>
                  <span class="status-badge status-inactive" *ngIf="student.studentStatus === 'inactive'">Inactive</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Subject Content Modal -->
      <div class="modal-overlay" *ngIf="showSubjectContentModal" (click)="closeSubjectContentModal()">
        <div class="modal-content student-modal" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>{{ subjectContentModalMode === 'edit' ? 'Edit Content' : 'Content Details' }}</h2>
            <button class="close-btn" (click)="closeSubjectContentModal()">&times;</button>
          </div>
          <div class="modal-body">
            <div *ngIf="subjectContentModalMode === 'view' && selectedSubjectContent" class="student-details-grid">
              <div class="detail-item">
                <span class="detail-label">Subject</span>
                <span class="detail-value">{{ getSubjectName(selectedSubjectContent.subjectId) }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Type</span>
                <span class="detail-value">{{ selectedSubjectContent.type }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Title</span>
                <span class="detail-value">{{ selectedSubjectContent.title }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Unit</span>
                <span class="detail-value">{{ selectedSubjectContent.unit || 'N/A' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Topic</span>
                <span class="detail-value">{{ selectedSubjectContent.topicName || 'N/A' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Status</span>
                <span class="detail-value">{{ selectedSubjectContent.status || 'active' }}</span>
              </div>
              <div class="detail-item full-width">
                <span class="detail-label">Description</span>
                <span class="detail-value">{{ selectedSubjectContent.description || 'N/A' }}</span>
              </div>
              <div class="detail-item full-width" *ngIf="selectedSubjectContent.linkUrl">
                <span class="detail-label">Link</span>
                <span class="detail-value"><a [href]="selectedSubjectContent.linkUrl" target="_blank">Open</a></span>
              </div>
              <div class="detail-item full-width" *ngIf="selectedSubjectContent.fileData">
                <span class="detail-label">File</span>
                <span class="detail-value">
                  <a [href]="selectedSubjectContent.fileData" [download]="selectedSubjectContent.fileName || 'file'">Download</a>
                </span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Visible to Students</span>
                <span class="detail-value">{{ selectedSubjectContent.visibleToStudents ? 'Yes' : 'No' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Visible to Parents</span>
                <span class="detail-value">{{ selectedSubjectContent.visibleToParents ? 'Yes' : 'No' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Teacher Editable</span>
                <span class="detail-value">{{ selectedSubjectContent.teacherEditable ? 'Yes' : 'No' }}</span>
              </div>
            </div>

            <div *ngIf="subjectContentModalMode === 'edit'">
              <div class="form-row">
                <div class="form-group">
                  <label>Subject</label>
                  <select class="form-input" [(ngModel)]="subjectContentEditForm.subjectId" disabled>
                    <option *ngFor="let subject of subjectList" [value]="subject.id">
                      {{ subject.subjectCode }} - {{ subject.name }}
                    </option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Type</label>
                  <select class="form-input" [(ngModel)]="subjectContentEditForm.type">
                    <option *ngFor="let type of subjectContentTypes" [value]="type">{{ type }}</option>
                  </select>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Title</label>
                  <input class="form-input" [(ngModel)]="subjectContentEditForm.title" placeholder="Title" />
                </div>
                <div class="form-group">
                  <label>Unit / Chapter</label>
                  <input class="form-input" [(ngModel)]="subjectContentEditForm.unit" placeholder="Unit / Chapter" />
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Topic</label>
                  <input class="form-input" [(ngModel)]="subjectContentEditForm.topicName" placeholder="Topic name" />
                </div>
                <div class="form-group">
                  <label>Section (optional)</label>
                  <select class="form-input" [(ngModel)]="subjectContentEditForm.sectionId">
                    <option value="">All Sections</option>
                    <option *ngFor="let section of subjectListSectionsByClass[subjectContentEditForm.classId || 0] || []" [value]="section.id">
                      {{ section.name }}
                    </option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label>Description</label>
                <textarea class="form-input" rows="3" [(ngModel)]="subjectContentEditForm.description" placeholder="Description"></textarea>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Upload File (PDF/PPT/Video)</label>
                  <input type="file" class="form-input" (change)="onEditSubjectContentFileSelect($event)" accept=".pdf,.ppt,.pptx,video/*" />
                  <small class="form-hint" *ngIf="subjectContentEditForm.fileName">Selected: {{ subjectContentEditForm.fileName }}</small>
                </div>
                <div class="form-group">
                  <label>Video / Link URL</label>
                  <input class="form-input" [(ngModel)]="subjectContentEditForm.linkUrl" placeholder="YouTube / Drive link" />
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Visible to Students</label>
                  <select class="form-input" [(ngModel)]="subjectContentEditForm.visibleToStudents">
                    <option [ngValue]="true">Yes</option>
                    <option [ngValue]="false">No</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Visible to Parents</label>
                  <select class="form-input" [(ngModel)]="subjectContentEditForm.visibleToParents">
                    <option [ngValue]="true">Yes</option>
                    <option [ngValue]="false">No</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Teacher Edit Allowed</label>
                  <select class="form-input" [(ngModel)]="subjectContentEditForm.teacherEditable">
                    <option [ngValue]="true">Yes</option>
                    <option [ngValue]="false">No</option>
                  </select>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Status</label>
                  <select class="form-input" [(ngModel)]="subjectContentEditForm.status">
                    <option value="active">active</option>
                    <option value="inactive">inactive</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn-secondary" (click)="closeSubjectContentModal()">Close</button>
            <button class="btn-primary" *ngIf="subjectContentModalMode === 'edit'" (click)="saveSubjectContentChanges()">Save</button>
          </div>
        </div>
      </div>

      <!-- Teacher Modal -->
      <div class="modal-overlay" *ngIf="showTeacherModal" (click)="closeTeacherModal()">
        <div class="modal-content student-modal" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>{{ isEditingTeacher ? 'Edit Teacher' : 'Teacher Details' }}</h2>
            <button class="close-btn" (click)="closeTeacherModal()">&times;</button>
          </div>
          <div class="modal-body">
            <div *ngIf="!isEditingTeacher && selectedTeacher" class="student-view">
              <div class="student-profile-header">
                <div class="student-avatar-large">
                  <img *ngIf="selectedTeacher.profileImage" [src]="selectedTeacher.profileImage" />
                  <span *ngIf="!selectedTeacher.profileImage">{{ (selectedTeacher.firstName && selectedTeacher.firstName.charAt(0)) || 'T' }}{{ (selectedTeacher.lastName && selectedTeacher.lastName.charAt(0)) || '' }}</span>
                </div>
                <div>
                  <h3>{{ selectedTeacher.firstName }} {{ selectedTeacher.lastName }}</h3>
                  <p>{{ selectedTeacher.email }}</p>
                  <p *ngIf="selectedTeacher.employeeId">Employee ID: {{ selectedTeacher.employeeId }}</p>
                </div>
              </div>
              <div class="student-details-grid">
                <div class="detail-item">
                  <span class="detail-label">Qualification</span>
                  <span class="detail-value">{{ selectedTeacher.qualification || 'N/A' }}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Specialization</span>
                  <span class="detail-value">{{ selectedTeacher.specialization || 'N/A' }}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Status</span>
                  <span class="detail-value">{{ selectedTeacher.status || 'N/A' }}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Phone</span>
                  <span class="detail-value">{{ selectedTeacher.phone || 'N/A' }}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Gender</span>
                  <span class="detail-value">{{ selectedTeacher.gender || 'N/A' }}</span>
                </div>
                <div class="detail-item full-width">
                  <span class="detail-label">Address</span>
                  <span class="detail-value">{{ selectedTeacher.address || 'N/A' }}</span>
                </div>
                <div class="detail-item full-width" *ngIf="selectedTeacher.bio">
                  <span class="detail-label">Bio</span>
                  <span class="detail-value">{{ selectedTeacher.bio }}</span>
                </div>
              </div>
              
              <!-- Documents Section -->
              <div class="documents-view-section" *ngIf="selectedTeacherAdmissionForView">
                <h4 class="documents-title">Documents</h4>
                <div class="documents-grid-view">
                  <div class="doc-view-item" *ngIf="selectedTeacherAdmissionForView.photo">
                    <label>Photo</label>
                    <div class="doc-preview-container">
                      <img [src]="selectedTeacherAdmissionForView.photo" class="doc-preview-large" />
                    </div>
                  </div>
                  <div class="doc-view-item" *ngIf="selectedTeacherAdmissionForView.idProof">
                    <label>ID Proof</label>
                    <div class="doc-preview-container">
                      <img *ngIf="selectedTeacherAdmissionForView.idProof && selectedTeacherAdmissionForView.idProof.startsWith('data:image')" [src]="selectedTeacherAdmissionForView.idProof" class="doc-preview-large" />
                      <a *ngIf="selectedTeacherAdmissionForView.idProof && !selectedTeacherAdmissionForView.idProof.startsWith('data:image')" [href]="selectedTeacherAdmissionForView.idProof" target="_blank" class="doc-link">View PDF</a>
                    </div>
                  </div>
                  <div class="doc-view-item" *ngIf="selectedTeacherAdmissionForView.degreeCertificate">
                    <label>Degree Certificate</label>
                    <div class="doc-preview-container">
                      <img *ngIf="selectedTeacherAdmissionForView.degreeCertificate && selectedTeacherAdmissionForView.degreeCertificate.startsWith('data:image')" [src]="selectedTeacherAdmissionForView.degreeCertificate" class="doc-preview-large" />
                      <a *ngIf="selectedTeacherAdmissionForView.degreeCertificate && !selectedTeacherAdmissionForView.degreeCertificate.startsWith('data:image')" [href]="selectedTeacherAdmissionForView.degreeCertificate" target="_blank" class="doc-link">View PDF</a>
                    </div>
                  </div>
                  <div class="doc-view-item" *ngIf="selectedTeacherAdmissionForView.resume">
                    <label>Resume</label>
                    <div class="doc-preview-container">
                      <img *ngIf="selectedTeacherAdmissionForView.resume && selectedTeacherAdmissionForView.resume.startsWith('data:image')" [src]="selectedTeacherAdmissionForView.resume" class="doc-preview-large" />
                      <a *ngIf="selectedTeacherAdmissionForView.resume && !selectedTeacherAdmissionForView.resume.startsWith('data:image')" [href]="selectedTeacherAdmissionForView.resume" target="_blank" class="doc-link">View PDF</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div *ngIf="isEditingTeacher" class="student-edit-form">
              <div class="form-group">
                <label>Employee ID</label>
                <input type="text" class="form-input" [(ngModel)]="teacherEditForm.employeeId" />
              </div>
              <div class="form-group">
                <label>Qualification</label>
                <input type="text" class="form-input" [(ngModel)]="teacherEditForm.qualification" />
              </div>
              <div class="form-group">
                <label>Specialization</label>
                <input type="text" class="form-input" [(ngModel)]="teacherEditForm.specialization" />
              </div>
              <div class="form-group">
                <label>First Name</label>
                <input type="text" class="form-input" [(ngModel)]="teacherEditForm.firstName" />
              </div>
              <div class="form-group">
                <label>Last Name</label>
                <input type="text" class="form-input" [(ngModel)]="teacherEditForm.lastName" />
              </div>
              <div class="form-group">
                <label>Phone</label>
                <input type="tel" class="form-input" [(ngModel)]="teacherEditForm.phone" />
              </div>
              <div class="form-group">
                <label>Gender</label>
                <select class="form-input" [(ngModel)]="teacherEditForm.gender">
                  <option value="">Select</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <div class="form-group">
                <label>Address</label>
                <textarea class="form-input" [(ngModel)]="teacherEditForm.address" rows="3"></textarea>
              </div>
              <div class="form-group">
                <label>Bio</label>
                <textarea class="form-input" [(ngModel)]="teacherEditForm.bio" rows="3"></textarea>
              </div>
            </div>
          </div>
          <div class="modal-footer" *ngIf="isEditingTeacher">
            <button class="btn-secondary" (click)="closeTeacherModal()">Cancel</button>
            <button class="btn-primary" (click)="saveTeacherChanges()">Save Changes</button>
          </div>
        </div>
      </div>

      <!-- Teacher Admission Approval Modal -->
      <div class="modal-overlay" *ngIf="showTeacherAdmissionModal || isApprovingTeacherAdmission" (click)="closeTeacherAdmissionModal()">
        <div class="modal-content student-modal" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>{{ isApprovingTeacherAdmission ? 'Approve Teacher Admission' : 'Teacher Admission Details' }}</h2>
            <button class="close-btn" (click)="closeTeacherAdmissionModal()">&times;</button>
          </div>
          <div class="modal-body" *ngIf="selectedTeacherAdmission">
            <div *ngIf="!isApprovingTeacherAdmission" class="student-view">
              <div class="student-profile-header">
                <div class="student-avatar-large">
                  <img *ngIf="selectedTeacherAdmission.photo" [src]="selectedTeacherAdmission.photo" />
                  <span *ngIf="!selectedTeacherAdmission.photo">{{ (selectedTeacherAdmission.firstName && selectedTeacherAdmission.firstName.charAt(0)) || 'T' }}{{ (selectedTeacherAdmission.lastName && selectedTeacherAdmission.lastName.charAt(0)) || '' }}</span>
                </div>
                <div>
                  <h3>{{ selectedTeacherAdmission.firstName }} {{ selectedTeacherAdmission.lastName }}</h3>
                  <p>{{ selectedTeacherAdmission.email }}</p>
                  <p>{{ selectedTeacherAdmission.phone || 'N/A' }}</p>
                </div>
              </div>
              <div class="student-details-grid">
                <div class="detail-item">
                  <span class="detail-label">Qualification</span>
                  <span class="detail-value">{{ selectedTeacherAdmission.qualification || 'N/A' }}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Experience</span>
                  <span class="detail-value">{{ selectedTeacherAdmission.experience || 'N/A' }}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Status</span>
                  <span class="status-badge" [class]="'status-' + selectedTeacherAdmission.status">
                    {{ selectedTeacherAdmission.status | titlecase }}
                  </span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Submitted At</span>
                  <span class="detail-value">{{ formatAdmissionDate(selectedTeacherAdmission.submittedAt) }}</span>
                </div>
              </div>
              
              <!-- Documents Section -->
              <div class="documents-view-section">
                <h4 class="documents-title">Documents</h4>
                <div class="documents-grid-view">
                  <div class="doc-view-item" *ngIf="selectedTeacherAdmission.photo">
                    <label>Photo</label>
                    <div class="doc-preview-container">
                      <img [src]="selectedTeacherAdmission.photo" class="doc-preview-large" />
                    </div>
                  </div>
                  <div class="doc-view-item" *ngIf="selectedTeacherAdmission.idProof">
                    <label>ID Proof</label>
                    <div class="doc-preview-container">
                      <img *ngIf="selectedTeacherAdmission.idProof && selectedTeacherAdmission.idProof.startsWith('data:image')" [src]="selectedTeacherAdmission.idProof" class="doc-preview-large" />
                      <a *ngIf="selectedTeacherAdmission.idProof && !selectedTeacherAdmission.idProof.startsWith('data:image')" [href]="selectedTeacherAdmission.idProof" target="_blank" class="doc-link">View PDF</a>
                    </div>
                  </div>
                  <div class="doc-view-item" *ngIf="selectedTeacherAdmission.degreeCertificate">
                    <label>Degree Certificate</label>
                    <div class="doc-preview-container">
                      <img *ngIf="selectedTeacherAdmission.degreeCertificate && selectedTeacherAdmission.degreeCertificate.startsWith('data:image')" [src]="selectedTeacherAdmission.degreeCertificate" class="doc-preview-large" />
                      <a *ngIf="selectedTeacherAdmission.degreeCertificate && !selectedTeacherAdmission.degreeCertificate.startsWith('data:image')" [href]="selectedTeacherAdmission.degreeCertificate" target="_blank" class="doc-link">View PDF</a>
                    </div>
                  </div>
                  <div class="doc-view-item" *ngIf="selectedTeacherAdmission.resume">
                    <label>Resume</label>
                    <div class="doc-preview-container">
                      <img *ngIf="selectedTeacherAdmission.resume && selectedTeacherAdmission.resume.startsWith('data:image')" [src]="selectedTeacherAdmission.resume" class="doc-preview-large" />
                      <a *ngIf="selectedTeacherAdmission.resume && !selectedTeacherAdmission.resume.startsWith('data:image')" [href]="selectedTeacherAdmission.resume" target="_blank" class="doc-link">View PDF</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div *ngIf="isApprovingTeacherAdmission" class="student-edit-form">
              <div class="form-group">
                <label>Subjects (Optional)</label>
                <input type="text" class="form-input" [(ngModel)]="approvalSubjects" placeholder="Enter subjects (comma-separated)" />
              </div>
              <div class="form-group">
                <label>Assigned Classes (Optional)</label>
                <input type="text" class="form-input" [(ngModel)]="approvalAssignedClasses" placeholder="Enter assigned classes" />
              </div>
              <div class="form-group">
                <label>Remark (Optional)</label>
                <textarea class="form-input" [(ngModel)]="approvalTeacherRemark" rows="3" placeholder="Add any remarks"></textarea>
              </div>
            </div>
          </div>
          <div class="modal-footer" *ngIf="isApprovingTeacherAdmission">
            <button class="btn-secondary" (click)="closeTeacherAdmissionModal()">Cancel</button>
            <button class="btn-primary" (click)="submitTeacherAdmissionApproval()">Approve & Create Account</button>
          </div>
        </div>
      </div>

      <!-- Student Admission Approval Modal -->
      <div class="modal-overlay" *ngIf="showAdmissionModal || isApprovingAdmission" (click)="closeAdmissionModal()">
        <div class="modal-content student-modal" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>{{ isApprovingAdmission ? 'Approve Student Admission' : 'Student Admission Details' }}</h2>
            <button class="close-btn" (click)="closeAdmissionModal()">&times;</button>
          </div>
          <div class="modal-body" *ngIf="selectedAdmission">
            <div *ngIf="!isApprovingAdmission" class="student-view">
              <div class="student-profile-header">
                <div class="student-avatar-large">
                  <img *ngIf="selectedAdmission.photo" [src]="selectedAdmission.photo" />
                  <span *ngIf="!selectedAdmission.photo">{{ (selectedAdmission.firstName && selectedAdmission.firstName.charAt(0)) || 'S' }}{{ (selectedAdmission.lastName && selectedAdmission.lastName.charAt(0)) || '' }}</span>
                </div>
                <div>
                  <h3>{{ selectedAdmission.firstName }} {{ selectedAdmission.lastName }}</h3>
                  <p>{{ selectedAdmission.email }}</p>
                  <p>{{ selectedAdmission.phone || 'N/A' }}</p>
                </div>
              </div>
              <div class="student-details-grid">
                <div class="detail-item">
                  <span class="detail-label">Course *</span>
                  <select class="form-input" [(ngModel)]="viewCourseId" (change)="onViewCourseChange()" style="width: 100%; margin-top: 4px;">
                    <option [value]="null" disabled>Select Course</option>
                    <option *ngFor="let course of viewCourses" [value]="course.id">{{ course.name }}</option>
                  </select>
                  <div *ngIf="!viewCourses || viewCourses.length === 0" style="color: #ef4444; font-size: 12px; margin-top: 4px;">No courses available</div>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Academic Year</span>
                  <span class="detail-value">{{ selectedAdmission.academicYear || 'N/A' }}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Status</span>
                  <span class="status-badge" [class]="'status-' + selectedAdmission.status">
                    {{ selectedAdmission.status | titlecase }}
                  </span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Submitted At</span>
                  <span class="detail-value">{{ formatAdmissionDate(selectedAdmission.submittedAt) }}</span>
                </div>
                <div class="detail-item full-width">
                  <span class="detail-label">Address</span>
                  <span class="detail-value">{{ selectedAdmission.address || 'N/A' }}</span>
                </div>
                <div class="detail-item full-width">
                  <span class="detail-label">Previous Qualification</span>
                  <span class="detail-value">{{ selectedAdmission.previousQualification || 'N/A' }}</span>
                </div>
              </div>
              
              <!-- Documents Section -->
              <div class="documents-view-section">
                <h4 class="documents-title">Documents</h4>
                <div class="documents-grid-view">
                  <div class="doc-view-item" *ngIf="selectedAdmission.photo">
                    <label>Photo</label>
                    <div class="doc-preview-container">
                      <img [src]="selectedAdmission.photo" class="doc-preview-large" />
                    </div>
                  </div>
                  <div class="doc-view-item" *ngIf="selectedAdmission.idProof">
                    <label>ID Proof</label>
                    <div class="doc-preview-container">
                      <img *ngIf="selectedAdmission.idProof.startsWith('data:image')" [src]="selectedAdmission.idProof" class="doc-preview-large" />
                      <a *ngIf="!selectedAdmission.idProof.startsWith('data:image')" [href]="selectedAdmission.idProof" target="_blank" class="doc-link">View PDF</a>
                    </div>
                  </div>
                  <div class="doc-view-item" *ngIf="selectedAdmission.marksheet">
                    <label>Marksheet</label>
                    <div class="doc-preview-container">
                      <img *ngIf="selectedAdmission.marksheet.startsWith('data:image')" [src]="selectedAdmission.marksheet" class="doc-preview-large" />
                      <a *ngIf="!selectedAdmission.marksheet.startsWith('data:image')" [href]="selectedAdmission.marksheet" target="_blank" class="doc-link">View PDF</a>
                    </div>
                  </div>
                  <div class="doc-view-item" *ngIf="selectedAdmission.tcLc">
                    <label>TC / LC</label>
                    <div class="doc-preview-container">
                      <img *ngIf="selectedAdmission.tcLc.startsWith('data:image')" [src]="selectedAdmission.tcLc" class="doc-preview-large" />
                      <a *ngIf="!selectedAdmission.tcLc.startsWith('data:image')" [href]="selectedAdmission.tcLc" target="_blank" class="doc-link">View PDF</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div *ngIf="isApprovingAdmission" class="student-edit-form">
              <div class="form-group">
                <label>Course *</label>
                <select class="form-input" [(ngModel)]="approvalCourseId" (change)="onApprovalCourseChange()">
                  <option [value]="null">Select a course</option>
                  <option *ngFor="let course of courses" [value]="course.id">{{ course.name }}</option>
                </select>
              </div>
              <div class="form-group" *ngIf="approvalCourseId">
                <label>Class / Semester *</label>
                <select class="form-input" [(ngModel)]="approvalClassId" (change)="onApprovalClassChange()">
                  <option [value]="null">Select a class/semester</option>
                  <option *ngFor="let classItem of approvalClasses" [value]="classItem.id">{{ classItem.name }}</option>
                </select>
              </div>
              <div class="form-group" *ngIf="approvalClassId">
                <label>Class Section *</label>
                <select class="form-input" [(ngModel)]="approvalSectionId" (change)="onApprovalSectionChange()" style="appearance: auto; -webkit-appearance: menulist; -moz-appearance: menulist;">
                  <option [value]="null" disabled>-- Select Section (A, B, C, etc.) --</option>
                  <option *ngFor="let section of approvalSections" [value]="section.id">{{ section.name }} (Capacity: {{ section.capacity || 0 }} students)</option>
                </select>
                <small class="form-hint" *ngIf="approvalSectionId && approvalSections.length > 0" style="color: #10b981; font-size: 12px; margin-top: 4px; display: block;">
                  ‚úì Selected: <strong>{{ getSectionName(approvalSectionId) }}</strong> | Capacity: {{ getSectionCapacity(approvalSectionId) }} students
                </small>
                <div *ngIf="approvalSections.length === 0 && approvalClassId" style="color: #ef4444; font-size: 12px; margin-top: 4px;">
                  ‚ö†Ô∏è No sections found for this class. Please create sections (A, B, C, etc.) first in "My Subjects" ‚Üí "Sections" tab.
                </div>
                <div *ngIf="approvalSections.length > 0" style="color: #10b981; font-size: 12px; margin-top: 4px;">
                  ‚úì {{ approvalSections.length }} section(s) available: {{ getApprovalSectionsNames() }}
                </div>
              </div>
              <div class="form-group" *ngIf="approvalSectionId">
                <label>Roll Number *</label>
                <input type="text" class="form-input" [(ngModel)]="approvalRollNumber" placeholder="Auto-generated roll number" [readonly]="true" />
                <small class="form-hint">Format: STUD{{ currentYear }}{{ getCourseNameForRoll(approvalCourseId) }}01</small>
              </div>
              <div class="form-group">
                <label>Remark (Optional)</label>
                <textarea class="form-input" [(ngModel)]="approvalRemark" rows="3" placeholder="Add any remarks"></textarea>
              </div>
            </div>
          </div>
          <div class="modal-footer" *ngIf="isApprovingAdmission">
            <button class="btn-secondary" (click)="closeAdmissionModal()">Cancel</button>
            <button class="btn-primary" (click)="submitAdmissionApproval()">Approve & Create Account</button>
          </div>
        </div>
      </div>

      <!-- Subject Assignment Modal -->
      <div class="modal-overlay" *ngIf="showTeacherSubjectModal" (click)="closeSubjectModal()">
        <div class="modal-content student-modal" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <div>
              <h2 class="modal-title">Assign Subjects</h2>
              <p class="modal-subtitle">{{ selectedTeacherForSubjects?.firstName }} {{ selectedTeacherForSubjects?.lastName }}</p>
            </div>
            <button class="close-btn" (click)="closeSubjectModal()" aria-label="Close">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label>Subjects *</label>
              <input 
                type="text" 
                class="form-input" 
                [(ngModel)]="teacherSubjectsInput" 
                placeholder="Enter subjects (comma-separated, e.g., Mathematics, Physics, Chemistry)"
              />
              <p class="form-hint">Separate multiple subjects with commas</p>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn-secondary" (click)="closeSubjectModal()">Cancel</button>
            <button class="btn-primary" (click)="saveTeacherSubjects()">Save Subjects</button>
          </div>
        </div>
      </div>

      <!-- Student Modal -->
      <div class="modal-overlay" *ngIf="showStudentModal" (click)="closeStudentModal()">
        <div class="modal-content student-modal" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>{{ isEditingStudent ? 'Edit Student' : 'Student Details' }}</h2>
            <button class="close-btn" (click)="closeStudentModal()">&times;</button>
          </div>
          <div class="modal-body">
            <div *ngIf="!isEditingStudent && selectedStudent" class="student-view">
              <div class="student-profile-header">
                <div class="student-avatar-large">
                  <img *ngIf="selectedStudent.profileImage" [src]="selectedStudent.profileImage" />
                  <span *ngIf="!selectedStudent.profileImage">{{ (selectedStudent.firstName && selectedStudent.firstName.charAt(0)) || 'S' }}{{ (selectedStudent.lastName && selectedStudent.lastName.charAt(0)) || '' }}</span>
                </div>
                <div>
                  <h3>{{ selectedStudent.firstName }} {{ selectedStudent.lastName }}</h3>
                  <p>{{ selectedStudent.email }}</p>
                  <p *ngIf="selectedStudent.rollNumber">Roll Number: {{ selectedStudent.rollNumber }}</p>
                </div>
              </div>
              <div class="student-details-grid">
                <div class="detail-item">
                  <span class="detail-label">Course *</span>
                  <select class="form-input" [(ngModel)]="studentViewCourseId" (change)="onStudentViewCourseChange()" style="width: 100%; margin-top: 4px;">
                    <option [value]="null" disabled>Select Course</option>
                    <option *ngFor="let course of studentViewCourses" [value]="course.id">{{ course.name }}</option>
                  </select>
                  <div *ngIf="!studentViewCourses || studentViewCourses.length === 0" style="color: #ef4444; font-size: 12px; margin-top: 4px;">No courses available</div>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Class Sect</span>
                  <span class="detail-value">{{ selectedStudent.classSection || 'N/A' }}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Academic Year</span>
                  <span class="detail-value">{{ selectedStudent.academicYear || 'N/A' }}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Status</span>
                  <span class="detail-value">{{ selectedStudent.studentStatus || 'N/A' }}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Phone</span>
                  <span class="detail-value">{{ selectedStudent.phone || 'N/A' }}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Gender</span>
                  <span class="detail-value">{{ selectedStudent.gender || 'N/A' }}</span>
                </div>
                <div class="detail-item full-width">
                  <span class="detail-label">Address</span>
                  <span class="detail-value">{{ selectedStudent.address || 'N/A' }}</span>
                </div>
                <div class="detail-item full-width" *ngIf="selectedStudent.bio">
                  <span class="detail-label">Bio</span>
                  <span class="detail-value">{{ selectedStudent.bio }}</span>
                </div>
              </div>
              
              <!-- Documents Section -->
              <div class="documents-view-section" *ngIf="selectedStudentAdmissionForView">
                <h4 class="documents-title">Documents</h4>
                <div class="documents-grid-view">
                  <div class="doc-view-item" *ngIf="selectedStudentAdmissionForView.photo">
                    <label>Photo</label>
                    <div class="doc-preview-container">
                      <img [src]="selectedStudentAdmissionForView.photo" class="doc-preview-large" />
                    </div>
                  </div>
                  <div class="doc-view-item" *ngIf="selectedStudentAdmissionForView.idProof">
                    <label>ID Proof</label>
                    <div class="doc-preview-container">
                      <img *ngIf="selectedStudentAdmissionForView.idProof && selectedStudentAdmissionForView.idProof.startsWith('data:image')" [src]="selectedStudentAdmissionForView.idProof" class="doc-preview-large" />
                      <a *ngIf="selectedStudentAdmissionForView.idProof && !selectedStudentAdmissionForView.idProof.startsWith('data:image')" [href]="selectedStudentAdmissionForView.idProof" target="_blank" class="doc-link">View PDF</a>
                    </div>
                  </div>
                  <div class="doc-view-item" *ngIf="selectedStudentAdmissionForView.marksheet">
                    <label>Marksheet</label>
                    <div class="doc-preview-container">
                      <img *ngIf="selectedStudentAdmissionForView.marksheet && selectedStudentAdmissionForView.marksheet.startsWith('data:image')" [src]="selectedStudentAdmissionForView.marksheet" class="doc-preview-large" />
                      <a *ngIf="selectedStudentAdmissionForView.marksheet && !selectedStudentAdmissionForView.marksheet.startsWith('data:image')" [href]="selectedStudentAdmissionForView.marksheet" target="_blank" class="doc-link">View PDF</a>
                    </div>
                  </div>
                  <div class="doc-view-item" *ngIf="selectedStudentAdmissionForView.tcLc">
                    <label>TC / LC</label>
                    <div class="doc-preview-container">
                      <img *ngIf="selectedStudentAdmissionForView.tcLc && selectedStudentAdmissionForView.tcLc.startsWith('data:image')" [src]="selectedStudentAdmissionForView.tcLc" class="doc-preview-large" />
                      <a *ngIf="selectedStudentAdmissionForView.tcLc && !selectedStudentAdmissionForView.tcLc.startsWith('data:image')" [href]="selectedStudentAdmissionForView.tcLc" target="_blank" class="doc-link">View PDF</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div *ngIf="isEditingStudent" class="student-edit-form">
              <div class="form-group">
                <label>Roll Number</label>
                <input type="text" class="form-input" [(ngModel)]="studentEditForm.rollNumber" />
              </div>
              <div class="form-group">
                <label>Class/Coe</label>
                <input type="text" class="form-input" [(ngModel)]="studentEditForm.classCourse" />
              </div>
              <div class="form-group">
                <label>Class Secti</label>
                <input type="text" class="form-input" [(ngModel)]="studentEditForm.classSection" />
              </div>
              <div class="form-group">
                <label>Academic Year</label>
                <input type="text" class="form-input" [(ngModel)]="studentEditForm.academicYear" />
              </div>
              <div class="form-group">
                <label>First Name</label>
                <input type="text" class="form-input" [(ngModel)]="studentEditForm.firstName" />
              </div>
              <div class="form-group">
                <label>Last Name</label>
                <input type="text" class="form-input" [(ngModel)]="studentEditForm.lastName" />
              </div>
              <div class="form-group">
                <label>Phone</label>
                <input type="tel" class="form-input" [(ngModel)]="studentEditForm.phone" />
              </div>
              <div class="form-group">
                <label>Gender</label>
                <select class="form-input" [(ngModel)]="studentEditForm.gender">
                  <option value="">Select</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <div class="form-group">
                <label>Address</label>
                <textarea class="form-input" [(ngModel)]="studentEditForm.address" rows="3"></textarea>
              </div>
              <div class="form-group">
                <label>Bio</label>
                <textarea class="form-input" [(ngModel)]="studentEditForm.bio" rows="3"></textarea>
              </div>
            </div>
          </div>
          <div class="modal-footer" *ngIf="isEditingStudent">
            <button class="btn-secondary" (click)="closeStudentModal()">Cancel</button>
            <button class="btn-primary" (click)="saveStudentChanges()">Save Changes</button>
          </div>
        </div>
      </div>

      <!-- Confirmation Dialog -->
      <div class="modal-overlay" *ngIf="showConfirmDialog" (click)="closeConfirmDialog()">
        <div class="modal-content confirm-dialog" (click)="$event.stopPropagation()">
          <div class="confirm-dialog-header">
            <h3>Confirm Action</h3>
          </div>
          <div class="confirm-dialog-body">
            <p>{{ confirmMessage }}</p>
          </div>
          <div class="confirm-dialog-footer">
            <button class="btn-secondary" (click)="closeConfirmDialog()">Cancel</button>
            <button class="btn-primary" (click)="confirmAction()">OK</button>
          </div>
        </div>
      </div>

      <!-- Snackbar -->
      <div class="snackbar" [class.show]="showSnackbar" [class.success]="snackbarType === 'success'" [class.error]="snackbarType === 'error'">
        <span>{{ snackbarMessage }}</span>
      </div>

      <!-- Course Modal -->
      <div class="modal-overlay" *ngIf="showCourseModal" (click)="showCourseModal = false">
        <div class="modal-content student-modal" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>{{ isEditingCourse ? 'Edit Course' : 'Create Course' }}</h2>
            <button class="close-btn" (click)="showCourseModal = false">&times;</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label>Course Name *</label>
              <input type="text" class="form-input" [(ngModel)]="courseForm.name" placeholder="e.g., BCA, BTech, 10th, 12th" />
            </div>
            <div class="form-group">
              <label>Type *</label>
              <select class="form-input" [(ngModel)]="courseForm.type">
                <option value="">Select Type</option>
                <option value="SCHOOL">School</option>
                <option value="COLLEGE">College</option>
              </select>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Duration (Years)</label>
                <input type="number" class="form-input" [(ngModel)]="courseForm.durationYears" />
              </div>
              <div class="form-group">
                <label>Duration (Semesters)</label>
                <input type="number" class="form-input" [(ngModel)]="courseForm.durationSemesters" />
              </div>
            </div>
            <div class="form-group">
              <label>Status</label>
              <select class="form-input" [(ngModel)]="courseForm.status">
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn-secondary" (click)="showCourseModal = false">Cancel</button>
            <button class="btn-primary" (click)="saveCourse()">Save</button>
          </div>
        </div>
      </div>

      <!-- Class Modal -->
      <div class="modal-overlay" *ngIf="showClassModal" (click)="showClassModal = false">
        <div class="modal-content student-modal" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>{{ isEditingClass ? 'Edit Class / Semester' : 'Create Class / Semester' }}</h2>
            <button class="close-btn" (click)="showClassModal = false">&times;</button>
          </div>
          <div class="modal-body">
            <div class="form-group" *ngIf="!isEditingClass">
              <label>Course *</label>
              <select class="form-input" [(ngModel)]="classForm.courseId">
                <option [value]="null">Select a course</option>
                <option *ngFor="let course of courses" [value]="course.id">{{ course.name }}</option>
              </select>
            </div>
            <div class="form-group" *ngIf="isEditingClass">
              <label>Course</label>
              <input type="text" class="form-input" [value]="getCourseName(classForm.courseId)" disabled />
            </div>
            <div class="form-group">
              <label>Name *</label>
              <input type="text" class="form-input" [(ngModel)]="classForm.name" placeholder="e.g., 10th, 11th, Sem 1, Sem 2" />
            </div>
            <div class="form-group">
              <label>Type *</label>
              <select class="form-input" [(ngModel)]="classForm.type">
                <option value="">Select Type</option>
                <option value="CLASS">Class</option>
                <option value="SEMESTER">Semester</option>
              </select>
            </div>
            <div class="form-group">
              <label>Academic Year</label>
              <input type="text" class="form-input" [(ngModel)]="classForm.academicYear" placeholder="e.g., 2024-2025" />
            </div>
            <div class="form-group">
              <label>Status</label>
              <select class="form-input" [(ngModel)]="classForm.status">
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn-secondary" (click)="showClassModal = false">Cancel</button>
            <button class="btn-primary" (click)="saveClass()">Save</button>
          </div>
        </div>
      </div>

      <!-- Subject Modal -->
      <div class="modal-overlay" *ngIf="showSubjectModal" (click)="showSubjectModal = false">
        <div class="modal-content student-modal" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>{{ isEditingSubject ? 'Edit Subject' : 'Create Subject' }}</h2>
            <button class="close-btn" (click)="showSubjectModal = false">&times;</button>
          </div>
          <div class="modal-body">
            <div class="form-group" *ngIf="!isEditingSubject">
              <label>Course *</label>
              <select class="form-input" [(ngModel)]="subjectForm.courseId" (change)="onSubjectCourseChange()">
                <option [value]="null">Select a course</option>
                <option *ngFor="let course of courses" [value]="course.id">{{ course.name }}</option>
              </select>
            </div>
            <div class="form-group" *ngIf="!isEditingSubject">
              <label>Class / Semester *</label>
              <select class="form-input" [(ngModel)]="subjectForm.classId" [disabled]="!subjectForm.courseId" (change)="onSubjectClassChange()">
                <option [value]="null">Select a class/semester</option>
                <option *ngFor="let classItem of classesForSubject" [value]="classItem.id">{{ classItem.name }}</option>
              </select>
              <small class="form-hint" *ngIf="subjectForm.classId && sectionsForSubjectClass.length > 0">
                üìå This subject will be available for ALL sections: {{ getSectionsNamesForSubject() }}
              </small>
              <small class="form-hint" *ngIf="subjectForm.classId && sectionsForSubjectClass.length === 0" style="color: #f59e0b;">
                ‚ö†Ô∏è No sections created yet. Create sections for this class first.
              </small>
            </div>
            <div class="form-group">
              <label>Subject Name *</label>
              <input type="text" class="form-input" [(ngModel)]="subjectForm.name" />
            </div>
            <div class="form-group">
              <label>Subject Code *</label>
              <input type="text" class="form-input" [(ngModel)]="subjectForm.subjectCode" />
            </div>
            <div class="form-group">
              <label>Subject Type *</label>
              <select class="form-input" [(ngModel)]="subjectForm.subjectType">
                <option value="">Select Type</option>
                <option value="THEORY">Theory</option>
                <option value="PRACTICAL">Practical</option>
                <option value="LAB">Lab</option>
              </select>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Max Marks</label>
                <input type="number" class="form-input" [(ngModel)]="subjectForm.maxMarks" />
              </div>
              <div class="form-group">
                <label>Credits</label>
                <input type="number" step="0.01" class="form-input" [(ngModel)]="subjectForm.credits" />
              </div>
            </div>
            <div class="form-group">
              <label>Status</label>
              <select class="form-input" [(ngModel)]="subjectForm.status">
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn-secondary" (click)="showSubjectModal = false" type="button">Cancel</button>
            <button class="btn-primary" (click)="saveSubject()" type="button">Save</button>
          </div>
        </div>
      </div>

      <!-- Section Modal -->
      <app-section-modal
        *ngIf="showSectionModal"
        [selectedClass]="selectedClassForSections"
        [sections]="sections"
        [sectionForm]="sectionForm"
        [isEditing]="isEditingSection"
        (close)="showSectionModal = false"
        (addNew)="sectionForm = { classId: selectedClassForSections?.id, status: 'active' }; isEditingSection = false"
        (save)="saveSection()"
        (cancel)="sectionForm = {}"
        (edit)="editSection($event)"
        (delete)="deleteSection($event.id!)"
      ></app-section-modal>

      <!-- Fee Structure Modal -->
      <app-fee-structure-modal
        *ngIf="showFeeStructureModal"
        [form]="feeStructureForm"
        [isEditing]="isEditingFeeStructure"
        [courses]="courses"
        [classes]="feeStructureFilterClasses"
        [sections]="feeStructureFilterSections"
        (close)="showFeeStructureModal = false"
        (save)="saveFeeStructure()"
        (courseChange)="onFeeStructureCourseChange()"
        (classChange)="onFeeStructureClassChange()"
      ></app-fee-structure-modal>

      <!-- Fee Assignment Modal -->
      <app-fee-assignment-modal
        *ngIf="showFeeAssignmentModal"
        [form]="feeAssignmentForm"
        [isEditing]="isEditingFeeAssignment"
        [students]="students"
        [feeStructures]="feeStructures"
        (close)="showFeeAssignmentModal = false"
        (save)="saveFeeAssignment()"
        (studentChange)="onFeeAssignmentStudentChange()"
        (structureChange)="onFeeAssignmentStructureChange()"
        (calculateFinalAmount)="calculateFinalAmount()"
      ></app-fee-assignment-modal>

      <app-footer></app-footer>
    </div>
